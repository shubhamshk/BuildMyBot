{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/lib/ai/provider-detection.ts"],"sourcesContent":["/**\r\n * Provider detection and model selection\r\n * Auto-detects provider from API key pattern and selects safe models\r\n */\r\n\r\nimport { APIProvider } from \"@/lib/api-key\";\r\n\r\nexport type GenerationType = \"personality\" | \"scenario\" | \"initialMessage\";\r\n\r\nexport interface ModelConfig {\r\n  default: string;\r\n  fallback?: string;\r\n  long?: string; // For personality generation\r\n}\r\n\r\nexport const MODEL_CONFIGS: Record<APIProvider, ModelConfig> = {\r\n  openai: {\r\n    default: \"gpt-4o-mini\",\r\n    long: \"gpt-4o\",\r\n    fallback: \"gpt-3.5-turbo\",\r\n  },\r\n  gemini: {\r\n    default: \"gemini-2.0-flash\",\r\n    fallback: \"gemini-1.5-flash\",\r\n    long: \"gemini-2.0-flash\",\r\n  },\r\n  openrouter: {\r\n    default: \"openai/gpt-4o-mini\",\r\n    long: \"openai/gpt-4o\",\r\n    fallback: \"openai/gpt-3.5-turbo\",\r\n  },\r\n  huggingface: {\r\n    default: \"meta-llama/Llama-3.1-8B-Instruct\",\r\n    fallback: \"mistralai/Mistral-7B-Instruct-v0.2\",\r\n  },\r\n};\r\n\r\n/**\r\n * Detect provider from API key pattern\r\n */\r\nexport function detectProviderFromKey(apiKey: string): APIProvider | null {\r\n  const trimmed = apiKey.trim();\r\n  \r\n  if (trimmed.startsWith(\"sk-or-\")) {\r\n    return \"openrouter\";\r\n  }\r\n  if (trimmed.startsWith(\"sk-\")) {\r\n    return \"openai\";\r\n  }\r\n  if (trimmed.startsWith(\"AIza\")) {\r\n    return \"gemini\";\r\n  }\r\n  if (trimmed.startsWith(\"hf_\")) {\r\n    return \"huggingface\";\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Get model for generation type\r\n */\r\nexport function getModelForGeneration(\r\n  provider: APIProvider,\r\n  generationType: GenerationType\r\n): string {\r\n  const config = MODEL_CONFIGS[provider];\r\n  \r\n  if (generationType === \"personality\" && config.long) {\r\n    return config.long;\r\n  }\r\n  \r\n  return config.default;\r\n}\r\n\r\n/**\r\n * Get fallback model for provider\r\n */\r\nexport function getFallbackModel(provider: APIProvider): string | null {\r\n  return MODEL_CONFIGS[provider].fallback || null;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;AAYM,MAAM,gBAAkD;IAC7D,QAAQ;QACN,SAAS;QACT,MAAM;QACN,UAAU;IACZ;IACA,QAAQ;QACN,SAAS;QACT,UAAU;QACV,MAAM;IACR;IACA,YAAY;QACV,SAAS;QACT,MAAM;QACN,UAAU;IACZ;IACA,aAAa;QACX,SAAS;QACT,UAAU;IACZ;AACF;AAKO,SAAS,sBAAsB,MAAc;IAClD,MAAM,UAAU,OAAO,IAAI;IAE3B,IAAI,QAAQ,UAAU,CAAC,WAAW;QAChC,OAAO;IACT;IACA,IAAI,QAAQ,UAAU,CAAC,QAAQ;QAC7B,OAAO;IACT;IACA,IAAI,QAAQ,UAAU,CAAC,SAAS;QAC9B,OAAO;IACT;IACA,IAAI,QAAQ,UAAU,CAAC,QAAQ;QAC7B,OAAO;IACT;IAEA,OAAO;AACT;AAKO,SAAS,sBACd,QAAqB,EACrB,cAA8B;IAE9B,MAAM,SAAS,aAAa,CAAC,SAAS;IAEtC,IAAI,mBAAmB,iBAAiB,OAAO,IAAI,EAAE;QACnD,OAAO,OAAO,IAAI;IACpB;IAEA,OAAO,OAAO,OAAO;AACvB;AAKO,SAAS,iBAAiB,QAAqB;IACpD,OAAO,aAAa,CAAC,SAAS,CAAC,QAAQ,IAAI;AAC7C"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/lib/api-key.ts"],"sourcesContent":["/**\r\n * API Key management utilities\r\n * All keys stored in localStorage (frontend only)\r\n */\r\n\r\nimport { detectProviderFromKey } from \"@/lib/ai/provider-detection\";\r\n\r\nexport type APIProvider = \"openai\" | \"gemini\" | \"openrouter\" | \"huggingface\";\r\n\r\nexport function getAPIKey(provider?: APIProvider): string | null {\r\n  if (provider) {\r\n    const key = localStorage.getItem(`api_key_${provider}`);\r\n    return key && key.trim() !== \"\" ? key : null;\r\n  }\r\n  \r\n  const selectedProvider = getSelectedProvider();\r\n  if (!selectedProvider) return null;\r\n  \r\n  const key = localStorage.getItem(`api_key_${selectedProvider}`);\r\n  return key && key.trim() !== \"\" ? key : null;\r\n}\r\n\r\nexport function setAPIKey(provider: APIProvider, key: string): void {\r\n  // Validate key format matches provider\r\n  const detected = detectProviderFromKey(key);\r\n  if (detected && detected !== provider) {\r\n    console.warn(`API key format suggests ${detected} but saving as ${provider}`);\r\n  }\r\n  \r\n  localStorage.setItem(`api_key_${provider}`, key.trim());\r\n  localStorage.setItem(\"api_key_provider\", provider);\r\n  localStorage.setItem(\"api_key_connected\", \"true\");\r\n}\r\n\r\nexport function getSelectedProvider(): APIProvider | null {\r\n  const provider = localStorage.getItem(\"api_key_provider\");\r\n  return provider as APIProvider | null;\r\n}\r\n\r\nexport function isAPIKeyConnected(): boolean {\r\n  // First check if there's a selected provider\r\n  const provider = getSelectedProvider();\r\n  if (!provider) {\r\n    // Clear any stale connected flag if no provider\r\n    localStorage.removeItem(\"api_key_connected\");\r\n    return false;\r\n  }\r\n  \r\n  // Get the actual key\r\n  const key = localStorage.getItem(`api_key_${provider}`);\r\n  \r\n  // Validate key exists and is not empty\r\n  if (!key || key.trim() === \"\" || key.length < 10) {\r\n    // Clear connected flag if key is invalid\r\n    localStorage.removeItem(\"api_key_connected\");\r\n    return false;\r\n  }\r\n  \r\n  // Check connected flag\r\n  const connected = localStorage.getItem(\"api_key_connected\");\r\n  return connected === \"true\";\r\n}\r\n\r\nexport function clearAPIKey(): void {\r\n  const provider = getSelectedProvider();\r\n  if (provider) {\r\n    localStorage.removeItem(`api_key_${provider}`);\r\n  }\r\n  localStorage.removeItem(\"api_key_provider\");\r\n  localStorage.removeItem(\"api_key_connected\");\r\n}\r\n\r\n/**\r\n * Clear all API keys from all providers\r\n */\r\nexport function clearAllAPIKeys(): void {\r\n  const providers: APIProvider[] = [\"openai\", \"gemini\", \"openrouter\", \"huggingface\"];\r\n  providers.forEach((provider) => {\r\n    localStorage.removeItem(`api_key_${provider}`);\r\n  });\r\n  localStorage.removeItem(\"api_key_provider\");\r\n  localStorage.removeItem(\"api_key_connected\");\r\n}\r\n\r\n/**\r\n * Get all configured API keys (masked for display)\r\n */\r\nexport function getAllAPIKeys(): Record<APIProvider, { exists: boolean; masked: string }> {\r\n  const providers: APIProvider[] = [\"openai\", \"gemini\", \"openrouter\", \"huggingface\"];\r\n  const result: Record<APIProvider, { exists: boolean; masked: string }> = {} as any;\r\n  \r\n  providers.forEach((provider) => {\r\n    const key = localStorage.getItem(`api_key_${provider}`);\r\n    if (key && key.trim() !== \"\") {\r\n      result[provider] = {\r\n        exists: true,\r\n        masked: key.length > 12 ? `${key.slice(0, 6)}...${key.slice(-4)}` : \"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\",\r\n      };\r\n    } else {\r\n      result[provider] = { exists: false, masked: \"\" };\r\n    }\r\n  });\r\n  \r\n  return result;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;CAGC,GAED;;AAIO,SAAS,UAAU,QAAsB;IAC9C,IAAI,UAAU;QACZ,MAAM,MAAM,aAAa,OAAO,CAAC,CAAC,QAAQ,EAAE,UAAU;QACtD,OAAO,OAAO,IAAI,IAAI,OAAO,KAAK,MAAM;IAC1C;IAEA,MAAM,mBAAmB;IACzB,IAAI,CAAC,kBAAkB,OAAO;IAE9B,MAAM,MAAM,aAAa,OAAO,CAAC,CAAC,QAAQ,EAAE,kBAAkB;IAC9D,OAAO,OAAO,IAAI,IAAI,OAAO,KAAK,MAAM;AAC1C;AAEO,SAAS,UAAU,QAAqB,EAAE,GAAW;IAC1D,uCAAuC;IACvC,MAAM,WAAW,IAAA,sMAAqB,EAAC;IACvC,IAAI,YAAY,aAAa,UAAU;QACrC,QAAQ,IAAI,CAAC,CAAC,wBAAwB,EAAE,SAAS,eAAe,EAAE,UAAU;IAC9E;IAEA,aAAa,OAAO,CAAC,CAAC,QAAQ,EAAE,UAAU,EAAE,IAAI,IAAI;IACpD,aAAa,OAAO,CAAC,oBAAoB;IACzC,aAAa,OAAO,CAAC,qBAAqB;AAC5C;AAEO,SAAS;IACd,MAAM,WAAW,aAAa,OAAO,CAAC;IACtC,OAAO;AACT;AAEO,SAAS;IACd,6CAA6C;IAC7C,MAAM,WAAW;IACjB,IAAI,CAAC,UAAU;QACb,gDAAgD;QAChD,aAAa,UAAU,CAAC;QACxB,OAAO;IACT;IAEA,qBAAqB;IACrB,MAAM,MAAM,aAAa,OAAO,CAAC,CAAC,QAAQ,EAAE,UAAU;IAEtD,uCAAuC;IACvC,IAAI,CAAC,OAAO,IAAI,IAAI,OAAO,MAAM,IAAI,MAAM,GAAG,IAAI;QAChD,yCAAyC;QACzC,aAAa,UAAU,CAAC;QACxB,OAAO;IACT;IAEA,uBAAuB;IACvB,MAAM,YAAY,aAAa,OAAO,CAAC;IACvC,OAAO,cAAc;AACvB;AAEO,SAAS;IACd,MAAM,WAAW;IACjB,IAAI,UAAU;QACZ,aAAa,UAAU,CAAC,CAAC,QAAQ,EAAE,UAAU;IAC/C;IACA,aAAa,UAAU,CAAC;IACxB,aAAa,UAAU,CAAC;AAC1B;AAKO,SAAS;IACd,MAAM,YAA2B;QAAC;QAAU;QAAU;QAAc;KAAc;IAClF,UAAU,OAAO,CAAC,CAAC;QACjB,aAAa,UAAU,CAAC,CAAC,QAAQ,EAAE,UAAU;IAC/C;IACA,aAAa,UAAU,CAAC;IACxB,aAAa,UAAU,CAAC;AAC1B;AAKO,SAAS;IACd,MAAM,YAA2B;QAAC;QAAU;QAAU;QAAc;KAAc;IAClF,MAAM,SAAmE,CAAC;IAE1E,UAAU,OAAO,CAAC,CAAC;QACjB,MAAM,MAAM,aAAa,OAAO,CAAC,CAAC,QAAQ,EAAE,UAAU;QACtD,IAAI,OAAO,IAAI,IAAI,OAAO,IAAI;YAC5B,MAAM,CAAC,SAAS,GAAG;gBACjB,QAAQ;gBACR,QAAQ,IAAI,MAAM,GAAG,KAAK,GAAG,IAAI,KAAK,CAAC,GAAG,GAAG,GAAG,EAAE,IAAI,KAAK,CAAC,CAAC,IAAI,GAAG;YACtE;QACF,OAAO;YACL,MAAM,CAAC,SAAS,GAAG;gBAAE,QAAQ;gBAAO,QAAQ;YAAG;QACjD;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/components/api-key-manager.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { X, Key, CheckCircle2, Eye, EyeOff, Trash2, Plus, AlertTriangle, Copy, Check } from \"lucide-react\";\r\nimport { getAPIKey, setAPIKey, getSelectedProvider, APIProvider, clearAPIKey, clearAllAPIKeys } from \"@/lib/api-key\";\r\nimport { detectProviderFromKey } from \"@/lib/ai/provider-detection\";\r\n\r\ninterface APIKeyManagerProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n}\r\n\r\nconst PROVIDERS: Array<{\r\n  value: APIProvider;\r\n  label: string;\r\n  placeholder: string;\r\n  description: string;\r\n  icon: string;\r\n}> = [\r\n  {\r\n    value: \"openai\",\r\n    label: \"OpenAI\",\r\n    placeholder: \"sk-...\",\r\n    description: \"GPT-4, GPT-3.5, and other OpenAI models\",\r\n    icon: \"ü§ñ\",\r\n  },\r\n  {\r\n    value: \"gemini\",\r\n    label: \"Google Gemini\",\r\n    placeholder: \"AIza...\",\r\n    description: \"Gemini Pro and other Google AI models\",\r\n    icon: \"üíé\",\r\n  },\r\n  {\r\n    value: \"openrouter\",\r\n    label: \"OpenRouter\",\r\n    placeholder: \"sk-or-...\",\r\n    description: \"Access to multiple models (Claude, DeepSeek, etc.)\",\r\n    icon: \"üåê\",\r\n  },\r\n  {\r\n    value: \"huggingface\",\r\n    label: \"HuggingFace\",\r\n    placeholder: \"hf_...\",\r\n    description: \"Open-source models from HuggingFace\",\r\n    icon: \"ü§ó\",\r\n  },\r\n];\r\n\r\nexport function APIKeyManager({ isOpen, onClose, onSave }: APIKeyManagerProps) {\r\n  const [activeTab, setActiveTab] = useState<APIProvider>(\"openai\");\r\n  const [apiKeys, setApiKeys] = useState<Record<APIProvider, string>>({\r\n    openai: \"\",\r\n    gemini: \"\",\r\n    openrouter: \"\",\r\n    huggingface: \"\",\r\n  });\r\n  const [showKeys, setShowKeys] = useState<Record<APIProvider, boolean>>({\r\n    openai: false,\r\n    gemini: false,\r\n    openrouter: false,\r\n    huggingface: false,\r\n  });\r\n  const [selectedProvider, setSelectedProvider] = useState<APIProvider | null>(null);\r\n  const [copiedKey, setCopiedKey] = useState<APIProvider | null>(null);\r\n\r\n  // Load existing keys on mount\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      const keys: Record<APIProvider, string> = {\r\n        openai: \"\",\r\n        gemini: \"\",\r\n        openrouter: \"\",\r\n        huggingface: \"\",\r\n      };\r\n\r\n      PROVIDERS.forEach((provider) => {\r\n        const key = getAPIKey(provider.value);\r\n        if (key) {\r\n          keys[provider.value] = key;\r\n        }\r\n      });\r\n\r\n      setApiKeys(keys);\r\n      setSelectedProvider(getSelectedProvider());\r\n      \r\n      // Set active tab to selected provider or first provider\r\n      const savedProvider = getSelectedProvider();\r\n      if (savedProvider) {\r\n        setActiveTab(savedProvider);\r\n      }\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const handleSaveKey = (provider: APIProvider) => {\r\n    const key = apiKeys[provider].trim();\r\n    if (!key) return;\r\n\r\n    // Validate key format (basic check)\r\n    if (key.length < 10) {\r\n      alert(\"Please enter a valid API key (minimum 10 characters)\");\r\n      return;\r\n    }\r\n\r\n    // Validate key format matches provider\r\n    const detected = detectProviderFromKey(key);\r\n    if (detected && detected !== provider) {\r\n      const confirmed = confirm(\r\n        `This API key format suggests it's for ${detected.toUpperCase()}, but you're saving it as ${provider.toUpperCase()}. Continue anyway?`\r\n      );\r\n      if (!confirmed) return;\r\n    } else if (!detected) {\r\n      alert(\"Warning: Could not detect API key format. Please verify it's correct for the selected provider.\");\r\n    }\r\n\r\n    setAPIKey(provider, key);\r\n    setSelectedProvider(provider);\r\n    \r\n    // Update local state\r\n    setApiKeys((prev) => ({ ...prev, [provider]: key }));\r\n    \r\n    // Show success feedback\r\n    setTimeout(() => {\r\n      onSave();\r\n    }, 300);\r\n  };\r\n\r\n  const handleDeleteKey = (provider: APIProvider) => {\r\n    if (confirm(`Are you sure you want to remove the ${PROVIDERS.find(p => p.value === provider)?.label} API key?`)) {\r\n      // Clear this specific key\r\n      localStorage.removeItem(`api_key_${provider}`);\r\n      \r\n      // If this was the selected provider, clear selection\r\n      if (selectedProvider === provider) {\r\n        localStorage.removeItem(\"api_key_provider\");\r\n        localStorage.removeItem(\"api_key_connected\");\r\n        setSelectedProvider(null);\r\n      }\r\n      \r\n      setApiKeys((prev) => ({ ...prev, [provider]: \"\" }));\r\n    }\r\n  };\r\n\r\n  const handleClearAll = () => {\r\n    if (confirm(\"Are you sure you want to remove ALL API keys? This action cannot be undone.\")) {\r\n      clearAllAPIKeys();\r\n      setApiKeys({\r\n        openai: \"\",\r\n        gemini: \"\",\r\n        openrouter: \"\",\r\n        huggingface: \"\",\r\n      });\r\n      setSelectedProvider(null);\r\n    }\r\n  };\r\n\r\n  const handleCopyKey = async (provider: APIProvider) => {\r\n    const key = apiKeys[provider];\r\n    if (key) {\r\n      try {\r\n        await navigator.clipboard.writeText(key);\r\n        setCopiedKey(provider);\r\n        setTimeout(() => setCopiedKey(null), 2000);\r\n      } catch (err) {\r\n        console.error(\"Failed to copy key:\", err);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getMaskedKey = (key: string) => {\r\n    if (!key) return \"\";\r\n    return key.length > 12 ? `${key.slice(0, 6)}...${key.slice(-4)}` : \"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\";\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setApiKeys({\r\n      openai: \"\",\r\n      gemini: \"\",\r\n      openrouter: \"\",\r\n      huggingface: \"\",\r\n    });\r\n    onClose();\r\n  };\r\n\r\n  const hasKey = (provider: APIProvider) => {\r\n    return !!apiKeys[provider];\r\n  };\r\n\r\n  const activeProvider = PROVIDERS.find((p) => p.value === activeTab);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <>\r\n          {/* Backdrop */}\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={handleClose}\r\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50\"\r\n          />\r\n\r\n          {/* Modal */}\r\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none\">\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n              animate={{ opacity: 1, scale: 1, y: 0 }}\r\n              exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n              transition={{ duration: 0.2, ease: [0.22, 1, 0.36, 1] }}\r\n              onClick={(e) => e.stopPropagation()}\r\n              className=\"glass rounded-3xl p-0 max-w-3xl w-full border border-border pointer-events-auto overflow-hidden\"\r\n            >\r\n              {/* Header */}\r\n              <div className=\"p-6 border-b border-border\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-12 h-12 rounded-xl bg-violet-500/20 flex items-center justify-center\">\r\n                      <Key className=\"w-6 h-6 text-violet-400\" />\r\n                    </div>\r\n                    <div>\r\n                      <h2 className=\"text-2xl font-semibold text-foreground\">\r\n                        API Key Manager\r\n                      </h2>\r\n                      <p className=\"text-sm text-muted-foreground\">\r\n                        Manage your AI provider API keys securely\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={handleClose}\r\n                    className=\"w-10 h-10 rounded-lg glass border border-border hover:bg-white/5 transition-colors flex items-center justify-center\"\r\n                  >\r\n                    <X className=\"w-5 h-5 text-foreground\" />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tabs */}\r\n              <div className=\"px-6 pt-6 border-b border-border\">\r\n                <div className=\"flex gap-2 overflow-x-auto pb-2\">\r\n                  {PROVIDERS.map((provider) => {\r\n                    const hasKeyForProvider = hasKey(provider.value);\r\n                    const isSelected = selectedProvider === provider.value;\r\n                    \r\n                    return (\r\n                      <button\r\n                        key={provider.value}\r\n                        onClick={() => setActiveTab(provider.value)}\r\n                        className={`px-4 py-2.5 rounded-xl transition-all whitespace-nowrap flex items-center gap-2 relative ${\r\n                          activeTab === provider.value\r\n                            ? \"bg-violet-500/20 border-2 border-violet-500 text-violet-400\"\r\n                            : \"glass border border-border hover:bg-white/5 text-muted-foreground\"\r\n                        }`}\r\n                      >\r\n                        <span className=\"text-lg\">{provider.icon}</span>\r\n                        <span className=\"font-medium\">{provider.label}</span>\r\n                        {hasKeyForProvider && (\r\n                          <div className={`w-2 h-2 rounded-full ${\r\n                            isSelected ? \"bg-violet-400\" : \"bg-green-400\"\r\n                          }`} />\r\n                        )}\r\n                        {isSelected && (\r\n                          <CheckCircle2 className=\"w-4 h-4 text-violet-400\" />\r\n                        )}\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Content */}\r\n              <div className=\"p-6\">\r\n                {activeProvider && (\r\n                  <div className=\"space-y-6\">\r\n                    {/* Provider Info */}\r\n                    <div>\r\n                      <div className=\"flex items-center gap-3 mb-2\">\r\n                        <span className=\"text-3xl\">{activeProvider.icon}</span>\r\n                        <div>\r\n                          <h3 className=\"text-xl font-semibold text-foreground\">\r\n                            {activeProvider.label}\r\n                          </h3>\r\n                          <p className=\"text-sm text-muted-foreground\">\r\n                            {activeProvider.description}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* API Key Input */}\r\n                    <div>\r\n                      <label className=\"text-sm font-medium text-foreground mb-2 block\">\r\n                        API Key\r\n                      </label>\r\n                      <div className=\"relative\">\r\n                        <input\r\n                          type={showKeys[activeTab] ? \"text\" : \"password\"}\r\n                          value={apiKeys[activeTab]}\r\n                          onChange={(e) =>\r\n                            setApiKeys((prev) => ({\r\n                              ...prev,\r\n                              [activeTab]: e.target.value,\r\n                            }))\r\n                          }\r\n                          placeholder={activeProvider.placeholder}\r\n                          className=\"w-full h-12 px-4 pr-12 rounded-xl glass border border-border focus:border-violet-500 transition-all outline-none font-mono text-sm\"\r\n                          autoFocus\r\n                        />\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() =>\r\n                            setShowKeys((prev) => ({\r\n                              ...prev,\r\n                              [activeTab]: !prev[activeTab],\r\n                            }))\r\n                          }\r\n                          className=\"absolute right-3 top-1/2 -translate-y-1/2 w-8 h-8 rounded-lg hover:bg-white/5 transition-colors flex items-center justify-center\"\r\n                        >\r\n                          {showKeys[activeTab] ? (\r\n                            <EyeOff className=\"w-4 h-4 text-muted-foreground\" />\r\n                          ) : (\r\n                            <Eye className=\"w-4 h-4 text-muted-foreground\" />\r\n                          )}\r\n                        </button>\r\n                      </div>\r\n                      <p className=\"text-xs text-muted-foreground mt-2\">\r\n                        Your API key is stored locally in your browser and never sent to our servers.\r\n                      </p>\r\n                    </div>\r\n\r\n                    {/* Status */}\r\n                    {hasKey(activeTab) && (\r\n                      <div className=\"p-4 rounded-xl glass border border-green-500/30 bg-green-500/10\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <CheckCircle2 className=\"w-5 h-5 text-green-400\" />\r\n                          <div>\r\n                            <p className=\"text-sm font-medium text-green-400\">\r\n                              API Key Configured\r\n                            </p>\r\n                            <p className=\"text-xs text-muted-foreground\">\r\n                              {selectedProvider === activeTab\r\n                                ? \"Currently active for generation\"\r\n                                : \"Click 'Save & Activate' to use this key\"}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex gap-3\">\r\n                      {hasKey(activeTab) && (\r\n                        <>\r\n                          <button\r\n                            onClick={() => handleCopyKey(activeTab)}\r\n                            className=\"px-4 py-2.5 rounded-xl glass border border-border hover:bg-white/5 transition-colors flex items-center gap-2 text-muted-foreground\"\r\n                            title=\"Copy API Key\"\r\n                          >\r\n                            {copiedKey === activeTab ? (\r\n                              <Check className=\"w-4 h-4 text-green-400\" />\r\n                            ) : (\r\n                              <Copy className=\"w-4 h-4\" />\r\n                            )}\r\n                            {copiedKey === activeTab ? \"Copied!\" : \"Copy\"}\r\n                          </button>\r\n                          <button\r\n                            onClick={() => handleDeleteKey(activeTab)}\r\n                            className=\"px-4 py-2.5 rounded-xl glass border border-red-500/30 hover:bg-red-500/10 transition-colors flex items-center gap-2 text-red-400\"\r\n                          >\r\n                            <Trash2 className=\"w-4 h-4\" />\r\n                            Remove\r\n                          </button>\r\n                        </>\r\n                      )}\r\n                      <button\r\n                        onClick={() => handleSaveKey(activeTab)}\r\n                        disabled={!apiKeys[activeTab].trim()}\r\n                        className=\"flex-1 py-2.5 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                      >\r\n                        <CheckCircle2 className=\"w-4 h-4\" />\r\n                        {hasKey(activeTab) ? \"Update & Activate\" : \"Save & Activate\"}\r\n                      </button>\r\n                    </div>\r\n\r\n                    {/* Help Links */}\r\n                    <div className=\"pt-4 border-t border-border\">\r\n                      <p className=\"text-xs text-muted-foreground mb-2\">Need help getting an API key?</p>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {activeTab === \"openai\" && (\r\n                          <a\r\n                            href=\"https://platform.openai.com/api-keys\"\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"text-xs text-violet-400 hover:text-violet-300 underline\"\r\n                          >\r\n                            Get OpenAI API Key ‚Üí\r\n                          </a>\r\n                        )}\r\n                        {activeTab === \"gemini\" && (\r\n                          <a\r\n                            href=\"https://makersuite.google.com/app/apikey\"\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"text-xs text-violet-400 hover:text-violet-300 underline\"\r\n                          >\r\n                            Get Gemini API Key ‚Üí\r\n                          </a>\r\n                        )}\r\n                        {activeTab === \"openrouter\" && (\r\n                          <a\r\n                            href=\"https://openrouter.ai/keys\"\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"text-xs text-violet-400 hover:text-violet-300 underline\"\r\n                          >\r\n                            Get OpenRouter API Key ‚Üí\r\n                          </a>\r\n                        )}\r\n                        {activeTab === \"huggingface\" && (\r\n                          <a\r\n                            href=\"https://huggingface.co/settings/tokens\"\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"text-xs text-violet-400 hover:text-violet-300 underline\"\r\n                          >\r\n                            Get HuggingFace Token ‚Üí\r\n                          </a>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Footer */}\r\n              <div className=\"p-6 border-t border-border bg-muted/30\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-4\">\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      {Object.values(apiKeys).filter((k) => k).length} of {PROVIDERS.length} providers configured\r\n                    </p>\r\n                    {Object.values(apiKeys).some((k) => k) && (\r\n                      <button\r\n                        onClick={handleClearAll}\r\n                        className=\"text-xs text-red-400 hover:text-red-300 flex items-center gap-1\"\r\n                      >\r\n                        <Trash2 className=\"w-3 h-3\" />\r\n                        Clear All Keys\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                  <button\r\n                    onClick={handleClose}\r\n                    className=\"px-4 py-2 rounded-xl glass border border-border hover:bg-white/5 transition-colors text-sm font-medium\"\r\n                  >\r\n                    Close\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 984, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/components/terminal-output.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Copy, CheckCircle2, RefreshCw, Loader2, Terminal } from \"lucide-react\";\r\n\r\ninterface TerminalOutputProps {\r\n  title: string;\r\n  content: string;\r\n  loading?: boolean;\r\n  error?: string | null;\r\n  onRewrite?: () => void;\r\n  isGenerating?: boolean;\r\n}\r\n\r\n/**\r\n * Render markdown-style text with bold and italic formatting\r\n */\r\nfunction renderFormattedText(text: string): React.ReactNode[] {\r\n  if (!text) return [];\r\n\r\n  const parts: React.ReactNode[] = [];\r\n  let key = 0;\r\n\r\n  // Split by paragraphs first\r\n  const paragraphs = text.split(/\\n\\n+/);\r\n\r\n  paragraphs.forEach((paragraph, pIndex) => {\r\n    if (pIndex > 0) {\r\n      parts.push(<div key={key++} className=\"h-4\" />); // Paragraph spacing\r\n    }\r\n\r\n    // Process inline formatting within each paragraph\r\n    // Handle **bold** and *italic* patterns\r\n    const lines = paragraph.split(/\\n/);\r\n    \r\n    lines.forEach((line, lIndex) => {\r\n      if (lIndex > 0) {\r\n        parts.push(<br key={key++} />);\r\n      }\r\n\r\n      // Regex to match **bold** and *italic* patterns\r\n      // Order matters: check for ** first, then *\r\n      const regex = /(\\*\\*[^*]+\\*\\*)|(\\*[^*]+\\*)/g;\r\n      let lastIndex = 0;\r\n      let match;\r\n\r\n      const lineContent: React.ReactNode[] = [];\r\n      let lineKey = 0;\r\n\r\n      while ((match = regex.exec(line)) !== null) {\r\n        // Add text before the match\r\n        if (match.index > lastIndex) {\r\n          lineContent.push(\r\n            <span key={lineKey++} className=\"text-gray-300\">\r\n              {line.slice(lastIndex, match.index)}\r\n            </span>\r\n          );\r\n        }\r\n\r\n        const matchText = match[0];\r\n        \r\n        if (matchText.startsWith(\"**\") && matchText.endsWith(\"**\")) {\r\n          // Bold text (dialogue)\r\n          const innerText = matchText.slice(2, -2);\r\n          lineContent.push(\r\n            <span key={lineKey++} className=\"font-bold text-white\">\r\n              {innerText}\r\n            </span>\r\n          );\r\n        } else if (matchText.startsWith(\"*\") && matchText.endsWith(\"*\")) {\r\n          // Italic text (descriptions)\r\n          const innerText = matchText.slice(1, -1);\r\n          lineContent.push(\r\n            <span key={lineKey++} className=\"italic text-gray-400\">\r\n              {innerText}\r\n            </span>\r\n          );\r\n        }\r\n\r\n        lastIndex = match.index + matchText.length;\r\n      }\r\n\r\n      // Add remaining text after last match\r\n      if (lastIndex < line.length) {\r\n        lineContent.push(\r\n          <span key={lineKey++} className=\"text-gray-300\">\r\n            {line.slice(lastIndex)}\r\n          </span>\r\n        );\r\n      }\r\n\r\n      // If no formatting was found, just add the plain text\r\n      if (lineContent.length === 0) {\r\n        lineContent.push(\r\n          <span key={lineKey++} className=\"text-gray-300\">\r\n            {line}\r\n          </span>\r\n        );\r\n      }\r\n\r\n      parts.push(<span key={key++}>{lineContent}</span>);\r\n    });\r\n  });\r\n\r\n  return parts;\r\n}\r\n\r\nexport function TerminalOutput({\r\n  title,\r\n  content,\r\n  loading = false,\r\n  error = null,\r\n  onRewrite,\r\n  isGenerating = false,\r\n}: TerminalOutputProps) {\r\n  const [copied, setCopied] = useState(false);\r\n\r\n  const copyToClipboard = () => {\r\n    navigator.clipboard.writeText(content);\r\n    setCopied(true);\r\n    setTimeout(() => setCopied(false), 2000);\r\n  };\r\n\r\n  return (\r\n    <div className=\"rounded-2xl overflow-hidden border border-border bg-[#1a1a2e]\">\r\n      {/* Terminal Header */}\r\n      <div className=\"flex items-center justify-between px-4 py-3 bg-[#16162a] border-b border-border\">\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Traffic lights */}\r\n          <div className=\"flex items-center gap-1.5\">\r\n            <div className=\"w-3 h-3 rounded-full bg-red-500/80\" />\r\n            <div className=\"w-3 h-3 rounded-full bg-yellow-500/80\" />\r\n            <div className=\"w-3 h-3 rounded-full bg-green-500/80\" />\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Terminal className=\"w-4 h-4 text-violet-400\" />\r\n            <span className=\"text-sm font-medium text-gray-300\">{title}</span>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Actions */}\r\n        <div className=\"flex items-center gap-2\">\r\n          {onRewrite && (\r\n            <button\r\n              onClick={onRewrite}\r\n              disabled={loading || isGenerating}\r\n              className=\"px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 transition-colors flex items-center gap-2 text-xs text-gray-400 hover:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {loading ? (\r\n                <Loader2 className=\"w-3.5 h-3.5 animate-spin\" />\r\n              ) : (\r\n                <RefreshCw className=\"w-3.5 h-3.5\" />\r\n              )}\r\n              Regenerate\r\n            </button>\r\n          )}\r\n          <button\r\n            onClick={copyToClipboard}\r\n            disabled={!content || loading}\r\n            className=\"px-3 py-1.5 rounded-lg bg-violet-500/20 hover:bg-violet-500/30 transition-colors flex items-center gap-2 text-xs text-violet-400 hover:text-violet-300 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            {copied ? (\r\n              <>\r\n                <CheckCircle2 className=\"w-3.5 h-3.5\" />\r\n                Copied!\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Copy className=\"w-3.5 h-3.5\" />\r\n                Copy\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Terminal Content */}\r\n      <div className=\"p-6 min-h-[200px] max-h-[600px] overflow-y-auto font-mono text-sm leading-relaxed\">\r\n        {loading ? (\r\n          <div className=\"flex items-center justify-center py-12\">\r\n            <Loader2 className=\"w-6 h-6 animate-spin text-violet-400\" />\r\n            <span className=\"ml-3 text-gray-400\">Generating...</span>\r\n          </div>\r\n        ) : error ? (\r\n          <div className=\"py-4 px-4 rounded-xl bg-red-500/10 border border-red-500/30\">\r\n            <p className=\"text-sm text-red-400 font-medium mb-1\">Generation Failed</p>\r\n            <p className=\"text-sm text-red-400/80\">{error}</p>\r\n            {onRewrite && (\r\n              <button\r\n                onClick={onRewrite}\r\n                className=\"mt-2 text-xs text-red-400 hover:text-red-300 underline\"\r\n              >\r\n                Try again\r\n              </button>\r\n            )}\r\n          </div>\r\n        ) : content ? (\r\n          <div className=\"space-y-0\">\r\n            {renderFormattedText(content)}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-gray-500 italic\">\r\n            Content will be generated here...\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1343, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/lib/ai/providers.ts"],"sourcesContent":["export interface AIProvider {\r\n  generate(prompt: string, apiKey: string, model: string, maxTokens?: number): Promise<string>;\r\n}\r\n\r\n/**\r\n * Google Gemini AI Provider\r\n */\r\nexport class GeminiProvider implements AIProvider {\r\n  async generate(prompt: string, apiKey: string, model: string, maxTokens: number = 1800): Promise<string> {\r\n    const url = `https://generativelanguage.googleapis.com/v1/models/${model}:generateContent?key=${apiKey}`;\r\n\r\n    const response = await fetch(url, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        contents: [\r\n          {\r\n            parts: [\r\n              {\r\n                text: prompt,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n        generationConfig: {\r\n          temperature: 0.7,\r\n          maxOutputTokens: maxTokens,\r\n        },\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      let errorMessage = `Gemini API error`;\r\n      try {\r\n        const errorJson = JSON.parse(errorText);\r\n        errorMessage = `Gemini API error: ${errorJson.error?.message || errorText}`;\r\n      } catch {\r\n        errorMessage = `Gemini API error: ${errorText}`;\r\n      }\r\n      throw new Error(errorMessage);\r\n    }\r\n\r\n    const data = await response.json();\r\n    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;\r\n    \r\n    // Fail loudly on empty response\r\n    if (!text || text.trim() === \"\") {\r\n      throw new Error(\"Gemini API returned empty response. Please check your API key and model access.\");\r\n    }\r\n    \r\n    return text.trim();\r\n  }\r\n}\r\n\r\n/**\r\n * OpenAI Provider\r\n */\r\nexport class OpenAIProvider implements AIProvider {\r\n  async generate(prompt: string, apiKey: string, model: string, maxTokens: number = 1800): Promise<string> {\r\n    // Handle system/user message split if prompt contains system instructions\r\n    let messages: Array<{ role: string; content: string }> = [];\r\n    \r\n    if (prompt.includes(\"CRITICAL RULES:\") || prompt.includes(\"You are an expert\")) {\r\n      // Split system and user prompts\r\n      const systemMatch = prompt.match(/^(.+?)(?=\\n\\nCHARACTER|CHARACTER BASICS|User-provided|Generate|Write|Create)/s);\r\n      const systemPrompt = systemMatch ? systemMatch[1].trim() : \"\";\r\n      const userPrompt = systemMatch ? prompt.replace(systemMatch[1], \"\").trim() : prompt;\r\n      \r\n      if (systemPrompt) {\r\n        messages.push({ role: \"system\", content: systemPrompt });\r\n      }\r\n      messages.push({ role: \"user\", content: userPrompt });\r\n    } else {\r\n      messages.push({ role: \"user\", content: prompt });\r\n    }\r\n\r\n    // Determine API endpoint based on model\r\n    const isOpenRouter = model.includes(\"/\");\r\n    const apiUrl = isOpenRouter\r\n      ? \"https://openrouter.ai/api/v1/chat/completions\"\r\n      : \"https://api.openai.com/v1/chat/completions\";\r\n\r\n    const headers: Record<string, string> = {\r\n      \"Content-Type\": \"application/json\",\r\n    };\r\n\r\n    if (isOpenRouter) {\r\n      headers[\"Authorization\"] = `Bearer ${apiKey}`;\r\n      headers[\"HTTP-Referer\"] = typeof window !== \"undefined\" ? window.location.origin : \"\";\r\n      headers[\"X-Title\"] = \"AI Character Builder\";\r\n    } else {\r\n      headers[\"Authorization\"] = `Bearer ${apiKey}`;\r\n    }\r\n\r\n    const response = await fetch(apiUrl, {\r\n      method: \"POST\",\r\n      headers,\r\n      body: JSON.stringify({\r\n        model: model,\r\n        messages,\r\n        temperature: 0.7,\r\n        max_tokens: maxTokens,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ error: { message: \"Unknown error\" } }));\r\n      throw new Error(`API error: ${error.error?.message || \"Unknown error\"}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    const text = data.choices?.[0]?.message?.content;\r\n    \r\n    // Fail loudly on empty response\r\n    if (!text || text.trim() === \"\") {\r\n      throw new Error(\"API returned empty response. Please check your API key and model access.\");\r\n    }\r\n    \r\n    return text.trim();\r\n  }\r\n}\r\n\r\n/**\r\n * HuggingFace Provider (basic implementation)\r\n */\r\nexport class HuggingFaceProvider implements AIProvider {\r\n  async generate(prompt: string, apiKey: string, model: string, maxTokens: number = 1800): Promise<string> {\r\n    // HuggingFace inference API\r\n    const url = `https://api-inference.huggingface.co/models/${model}`;\r\n\r\n    const response = await fetch(url, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${apiKey}`,\r\n      },\r\n      body: JSON.stringify({\r\n        inputs: prompt,\r\n        parameters: {\r\n          max_new_tokens: maxTokens,\r\n          temperature: 0.7,\r\n        },\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ error: \"Unknown error\" }));\r\n      throw new Error(`HuggingFace API error: ${error.error || \"Unknown error\"}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    const text = Array.isArray(data) ? data[0]?.generated_text : data.generated_text;\r\n    \r\n    // Fail loudly on empty response\r\n    if (!text || text.trim() === \"\") {\r\n      throw new Error(\"HuggingFace API returned empty response.\");\r\n    }\r\n    \r\n    return text.trim();\r\n  }\r\n}\r\n\r\n/**\r\n * Get AI provider instance\r\n */\r\nexport function getAIProvider(provider: \"openai\" | \"gemini\" | \"openrouter\" | \"huggingface\"): AIProvider {\r\n  if (provider === \"openai\" || provider === \"openrouter\") {\r\n    return new OpenAIProvider();\r\n  }\r\n  if (provider === \"gemini\") {\r\n    return new GeminiProvider();\r\n  }\r\n  if (provider === \"huggingface\") {\r\n    return new HuggingFaceProvider();\r\n  }\r\n  throw new Error(`Unknown provider: ${provider}`);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1511, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/lib/prompts/janitor-ai.ts"],"sourcesContent":["/**\r\n * Janitor AI format prompt builders\r\n * Follows exact template structure from Janitor AI Master Guide\r\n */\r\n\r\nimport { CharacterState } from \"@/context/CharacterContext\";\r\n\r\n/**\r\n * Normalize personality sliders into descriptive text\r\n */\r\nfunction normalizePersonality(personality: CharacterState[\"personality\"]): string {\r\n  const traits: string[] = [];\r\n\r\n  // Warmth\r\n  if (personality.warmth > 70) {\r\n    traits.push(\"warm, empathetic, and approachable\");\r\n  } else if (personality.warmth < 30) {\r\n    traits.push(\"reserved, stoic, and emotionally distant\");\r\n  } else {\r\n    traits.push(\"balanced in emotional warmth\");\r\n  }\r\n\r\n  // Confidence\r\n  if (personality.confidence > 70) {\r\n    traits.push(\"bold, assertive, and takes the lead\");\r\n  } else if (personality.confidence < 30) {\r\n    traits.push(\"shy, submissive, and prefers to follow\");\r\n  } else {\r\n    traits.push(\"moderately confident\");\r\n  }\r\n\r\n  // Calmness\r\n  if (personality.calmness > 70) {\r\n    traits.push(\"calm, predictable, and methodical\");\r\n  } else if (personality.calmness < 30) {\r\n    traits.push(\"chaotic, playful, and unpredictable\");\r\n  } else {\r\n    traits.push(\"balanced between calm and chaotic\");\r\n  }\r\n\r\n  // Reserve\r\n  if (personality.reserve > 70) {\r\n    traits.push(\"reserved, internal, and mysterious\");\r\n  } else if (personality.reserve < 30) {\r\n    traits.push(\"expressive, vibrant, and emotionally open\");\r\n  } else {\r\n    traits.push(\"moderately expressive\");\r\n  }\r\n\r\n  return traits.join(\", \");\r\n}\r\n\r\n/**\r\n * Build system prompt for Janitor AI personality generation\r\n */\r\nfunction buildPersonalitySystemPrompt(): string {\r\n  return `You are an expert Janitor AI bot creator. Your task is to create detailed, immersive character personalities following the EXACT Janitor AI format.\r\n\r\nCRITICAL RULES (NON-NEGOTIABLE):\r\n- NEVER control {{user}} or speak for the user\r\n- NEVER omit any section\r\n- NEVER add commentary or explanations\r\n- Use third-person narration only\r\n- Avoid negative instructions (say what they DO, not what they DON'T)\r\n- Permanent tokens should be concise but complete\r\n- Personality defines what is ALWAYS true\r\n- Dialogue examples are illustrative ONLY - do NOT use verbatim\r\n- Avoid excessive sexual detail in permanent tokens\r\n- Output plain text only - no markdown, no code blocks\r\n\r\nMANDATORY TEMPLATE STRUCTURE:\r\nYou MUST output EXACTLY this format with ALL sections filled:\r\n\r\n<npcs>\r\n(50‚Äì100 word descriptions for NPCs if relevant, or leave empty if none)\r\n</npcs>\r\n\r\n<character_name>\r\nFull Name:\r\nAliases:\r\nSpecies:\r\nNationality:\r\nEthnicity:\r\nAge:\r\nOccupation/Role:\r\nAppearance:\r\nScent:\r\nClothing:\r\n\r\n[Backstory:\r\nConcise but complete backstory.\r\nUse bullet points for key events.]\r\n\r\nCurrent Residence:\r\n\r\n[Relationships:\r\nDescribe relationships.\r\nInclude one short in-character quote per relationship.]\r\n\r\n[Personality\r\nTraits:\r\nLikes:\r\nDislikes:\r\nInsecurities:\r\nPhysical behaviour:\r\nOpinions:]\r\n\r\n[Intimacy\r\nTurn-ons:\r\nDuring Sex:]\r\n\r\n[Dialogue\r\nAccent/tone rules.\r\n[These are merely examples of how CHARACTER NAME may speak and should NOT be used verbatim.]\r\nGreeting:\r\nSurprised:\r\nStressed:\r\nMemory:\r\nOpinion:]\r\n\r\n[Notes\r\nMisc traits, secrets, quirks]\r\n</character_name>\r\n\r\nSTRICT REQUIREMENTS:\r\n- Fill ALL fields with appropriate, detailed content\r\n- Keep backstory concise but complete (2-4 paragraphs)\r\n- Dialogue examples should be natural and varied (1-2 sentences each)\r\n- Never include placeholder text like \"TBD\" or \"...\"\r\n- Never add explanations outside the template\r\n- Format must be preserved exactly as shown\r\n- Start with <npcs> and end with </character_name>\r\n- All brackets and tags must be included`;\r\n}\r\n\r\n/**\r\n * Build user prompt for personality generation\r\n */\r\nexport function buildJanitorPersonalityPrompt(character: CharacterState): string {\r\n  const normalizedTraits = normalizePersonality(character.personality);\r\n  const backstoryStyle = character.backstoryStyle || \"Mysterious Past\";\r\n  const speechTone = character.speechRules?.tone || \"Casual & Warm\";\r\n  const speechVocab = character.speechRules?.vocabulary || \"Conversational\";\r\n  const contentRating = character.boundaries?.contentRating || \"SFW\";\r\n  const setting = character.basics.setting || \"Modern Day\";\r\n  const relationship = character.basics.relationship || \"Stranger\";\r\n\r\n  return `Create a complete Janitor AI personality profile for this character:\r\n\r\nCHARACTER BASICS:\r\n- Name: ${character.basics.name}\r\n- Age: ${character.basics.age}\r\n- Gender: ${character.basics.gender}\r\n- Setting: ${setting}\r\n- Relationship to user: ${relationship}\r\n\r\nPERSONALITY TRAITS:\r\n${normalizedTraits}\r\n\r\nBACKSTORY STYLE: ${backstoryStyle}\r\n\r\nSPEECH STYLE:\r\n- Tone: ${speechTone}\r\n- Vocabulary: ${speechVocab}\r\n${character.speechRules?.patterns ? `- Patterns: ${character.speechRules.patterns}` : \"\"}\r\n\r\nCONTENT RATING: ${contentRating}\r\n${character.boundaries?.topics ? `- Topics to avoid: ${character.boundaries.topics}` : \"\"}\r\n${character.boundaries?.tone ? `- Overall tone: ${character.boundaries.tone}` : \"\"}\r\n\r\nCRITICAL: You MUST output the complete personality profile using ONLY the template format provided. Do not add any text before <npcs> or after </character_name>. Do not include explanations, comments, or markdown formatting. Output the raw template with all sections filled.`;\r\n}\r\n\r\n/**\r\n * Build prompt for scenario generation\r\n */\r\nexport function buildScenarioPrompt(character: CharacterState, userScenario?: string): string {\r\n  const systemPrompt = `You are an expert Janitor AI bot creator. Create an immersive scenario with greeting that:\r\n- Sets the scene with rich atmospheric details\r\n- Includes the character's first message/greeting naturally woven in\r\n- Uses **double asterisks** for character dialogue\r\n- Uses *single asterisks* for narrative descriptions and actions\r\n- NEVER controls {{user}} or speaks for the user\r\n- Is scene-forward and immersive\r\n- Avoids lore dumps\r\n- Shows the character in the moment\r\n\r\nFORMAT EXAMPLE:\r\n**It's [time/date]‚Äîa [atmosphere] day with [sensory details]. [Scene setup with context].**\r\n\r\n*[Character name] is [doing something], wearing [outfit description]. [More character details and actions]. [Their mannerisms and presence].*\r\n\r\n*[Narrative building tension or atmosphere. What's happening in the scene. The mood and context.]*\r\n\r\n*[Character notices {{user}} or initiates interaction. Their body language and expression.]* **\"[Character's spoken greeting or first words]\"** *[they say/whisper/call out], [additional action or expression].*\r\n\r\n*[Optional: More scene details or character thoughts/observations about the situation.]*\r\n\r\nThe output should be 4-8 paragraphs, alternating between **bold dialogue** and *italic descriptions*.`;\r\n\r\n  const userPrompt = userScenario\r\n    ? `User-provided scenario idea: ${userScenario}\\n\\nCreate an immersive scenario with the character's greeting woven in, following the format above.`\r\n    : `Generate an immersive scenario with greeting for this character:\r\n\r\nCHARACTER:\r\n- Name: ${character.basics.name}\r\n- Setting: ${character.basics.setting}\r\n- Backstory Style: ${character.backstoryStyle || \"Mysterious Past\"}\r\n- Personality: ${normalizePersonality(character.personality)}\r\n- Relationship to user: ${character.basics.relationship}\r\n- Speech Tone: ${character.speechRules?.tone || \"Casual & Warm\"}\r\n- Speech Vocabulary: ${character.speechRules?.vocabulary || \"Conversational\"}\r\n\r\nCreate an engaging scenario that sets up the world, shows the character in their element, and includes their natural first interaction/greeting with {{user}}. Use **bold** for dialogue and *italics* for descriptions.`;\r\n\r\n  return `${systemPrompt}\\n\\n${userPrompt}`;\r\n}\r\n\r\n/**\r\n * Build prompt for initial message generation (kept for backwards compatibility)\r\n */\r\nexport function buildInitialMessagePrompt(character: CharacterState, scenario?: string): string {\r\n  const systemPrompt = `You are an expert Janitor AI bot creator. Write the first message from the character that:\r\n- NEVER speaks or acts for {{user}}\r\n- Uses **double asterisks** for character dialogue\r\n- Uses *single asterisks* for narrative descriptions and actions\r\n- Is NPC-driven (the character initiates)\r\n- Avoids lore dumps\r\n- Has no time skips\r\n- Is scene-forward (shows what's happening NOW)\r\n- Sets the tone naturally\r\n\r\nThe message should be 2-4 paragraphs with rich sensory details.`;\r\n\r\n  const userPrompt = `Write the first message for:\r\n\r\nCHARACTER:\r\n- Name: ${character.basics.name}\r\n- Setting: ${character.basics.setting}\r\n- Personality: ${normalizePersonality(character.personality)}\r\n- Speech Tone: ${character.speechRules?.tone || \"Casual & Warm\"}\r\n- Speech Vocabulary: ${character.speechRules?.vocabulary || \"Conversational\"}\r\n${scenario ? `\\nSCENARIO:\\n${scenario}` : \"\"}\r\n\r\nGenerate the initial message using **bold** for dialogue and *italics* for descriptions/actions.`;\r\n\r\n  return `${systemPrompt}\\n\\n${userPrompt}`;\r\n}\r\n\r\n/**\r\n * Get system prompt for personality generation\r\n */\r\nexport function getPersonalitySystemPrompt(): string {\r\n  return buildPersonalitySystemPrompt();\r\n}\r\n\r\n/**\r\n * Build prompt for COMBINED scenario generation (multiple characters in one story)\r\n */\r\nexport function buildCombinedScenarioPrompt(characters: CharacterState[], userScenario?: string): string {\r\n  // Build character descriptions\r\n  const characterDescriptions = characters.map((char, index) => `\r\nCHARACTER ${index + 1}: ${char.basics.name}\r\n- Gender: ${char.basics.gender}\r\n- Age: ${char.basics.age}\r\n- Setting: ${char.basics.setting}\r\n- Backstory Style: ${char.backstoryStyle || \"Mysterious Past\"}\r\n- Personality: ${normalizePersonality(char.personality)}\r\n- Relationship to user: ${char.basics.relationship}\r\n- Speech Tone: ${char.speechRules?.tone || \"Casual & Warm\"}\r\n- Speech Vocabulary: ${char.speechRules?.vocabulary || \"Conversational\"}`).join(\"\\n\");\r\n\r\n  const characterNames = characters.map(c => c.basics.name).filter(Boolean).join(\" and \");\r\n\r\n  const systemPrompt = `You are an expert Janitor AI bot creator. Create an immersive scenario featuring MULTIPLE CHARACTERS together in ONE UNIFIED SCENE that:\r\n- Sets the scene with rich atmospheric details featuring ALL characters\r\n- Includes natural dialogue and interactions between the characters\r\n- Shows how the characters relate to each other AND to {{user}}\r\n- Uses **double asterisks** for character dialogue\r\n- Uses *single asterisks* for narrative descriptions and actions\r\n- NEVER controls {{user}} or speaks for the user\r\n- Is scene-forward and immersive\r\n- Avoids lore dumps\r\n- Shows ALL characters in the moment, interacting naturally\r\n\r\nFORMAT EXAMPLE FOR MULTIPLE CHARACTERS:\r\n**It's [time/date]‚Äîa [atmosphere] day with [sensory details]. [Scene setup with context involving all characters].**\r\n\r\n*[Character 1 name] is [doing something], while [Character 2 name] is [doing something nearby]. [Scene description showing both characters and their dynamic]. [Their interactions and mannerisms].*\r\n\r\n*[Narrative building tension or atmosphere. What's happening in the scene. How the characters interact with each other.]*\r\n\r\n*[One character notices {{user}} or initiates interaction. Their body language.]* **\"[Character 1's spoken greeting]\"** *[they say/whisper/call out].*\r\n\r\n*[Character 2 reacts or joins in.]* **\"[Character 2's spoken words]\"** *[they respond/add/comment], [action or expression].*\r\n\r\n*[Scene continues with natural multi-character dynamics and {{user}} being addressed or included.]*\r\n\r\nThe output should be 5-10 paragraphs, featuring ALL characters throughout, alternating between **bold dialogue** and *italic descriptions*. Each character should speak at least once.`;\r\n\r\n  const userPrompt = userScenario\r\n    ? `User-provided scenario idea: ${userScenario}\r\n\r\nCHARACTERS INVOLVED:\r\n${characterDescriptions}\r\n\r\nCreate an immersive COMBINED scenario featuring ${characterNames} together in one unified scene. Include greetings/dialogue from EACH character, woven naturally into the scene.`\r\n    : `Generate an immersive COMBINED scenario featuring these characters together:\r\n\r\n${characterDescriptions}\r\n\r\nCreate an engaging scenario where ${characterNames} are together in the same scene. Show their dynamics with each other, set up the world, and include their natural first interactions/greetings with {{user}}. Each character should have their own dialogue moments. Use **bold** for dialogue and *italics* for descriptions.`;\r\n\r\n  return `${systemPrompt}\\n\\n${userPrompt}`;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1797, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/lib/generation/service.ts"],"sourcesContent":["/**\r\n * AI Generation Service\r\n * Handles all AI content generation with API key management and auto-detection\r\n */\r\n\r\nimport { CharacterState } from \"@/context/CharacterContext\";\r\nimport { getAPIKey, getSelectedProvider, APIProvider } from \"@/lib/api-key\";\r\nimport { getAIProvider } from \"@/lib/ai/providers\";\r\nimport {\r\n  buildJanitorPersonalityPrompt,\r\n  getPersonalitySystemPrompt,\r\n  buildScenarioPrompt,\r\n  buildInitialMessagePrompt,\r\n  buildCombinedScenarioPrompt,\r\n} from \"@/lib/prompts/janitor-ai\";\r\nimport {\r\n  detectProviderFromKey,\r\n  getModelForGeneration,\r\n  getFallbackModel,\r\n  GenerationType,\r\n} from \"@/lib/ai/provider-detection\";\r\n\r\nexport interface GenerationState {\r\n  loading: boolean;\r\n  error: string | null;\r\n  content: string | null;\r\n}\r\n\r\n/**\r\n * Get max tokens based on generation type\r\n */\r\nfunction getMaxTokensForType(generationType: GenerationType): number {\r\n  switch (generationType) {\r\n    case \"personality\":\r\n      return 1800;\r\n    case \"scenario\":\r\n      return 1200; // Increased for combined scenario + greeting\r\n    case \"initialMessage\":\r\n      return 550;\r\n    default:\r\n      return 1800;\r\n  }\r\n}\r\n\r\n/**\r\n * Generate with fallback retry logic\r\n */\r\nasync function generateWithFallback(\r\n  provider: APIProvider,\r\n  apiKey: string,\r\n  prompt: string,\r\n  generationType: GenerationType\r\n): Promise<string> {\r\n  const model = getModelForGeneration(provider, generationType);\r\n  const aiProvider = getAIProvider(provider);\r\n  const maxTokens = getMaxTokensForType(generationType);\r\n  \r\n  try {\r\n    const result = await aiProvider.generate(prompt, apiKey, model, maxTokens);\r\n    return result;\r\n  } catch (error: any) {\r\n    // Try fallback model if available\r\n    const fallbackModel = getFallbackModel(provider);\r\n    if (fallbackModel && (error.message?.includes(\"model\") || error.message?.includes(\"404\"))) {\r\n      console.warn(`Primary model ${model} failed, trying fallback ${fallbackModel}`);\r\n      try {\r\n        const result = await aiProvider.generate(prompt, apiKey, fallbackModel, maxTokens);\r\n        return result;\r\n      } catch (fallbackError: any) {\r\n        throw new Error(`Generation failed with both models. Primary: ${error.message}. Fallback: ${fallbackError.message}`);\r\n      }\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Generate personality content in Janitor AI format\r\n */\r\nexport async function generatePersonality(\r\n  character: CharacterState,\r\n  apiKey: string,\r\n  provider: APIProvider\r\n): Promise<string> {\r\n  const systemPrompt = getPersonalitySystemPrompt();\r\n  const userPrompt = buildJanitorPersonalityPrompt(character);\r\n  \r\n  // For OpenAI/OpenRouter, use system/user messages\r\n  if (provider === \"openai\" || provider === \"openrouter\") {\r\n    const fullPrompt = `${systemPrompt}\\n\\n${userPrompt}`;\r\n    return await generateWithFallback(provider, apiKey, fullPrompt, \"personality\");\r\n  }\r\n  \r\n  // For Gemini/HuggingFace, combine into single prompt\r\n  const fullPrompt = `${systemPrompt}\\n\\n${userPrompt}`;\r\n  return await generateWithFallback(provider, apiKey, fullPrompt, \"personality\");\r\n}\r\n\r\n/**\r\n * Generate scenario\r\n */\r\nexport async function generateScenario(\r\n  character: CharacterState,\r\n  userScenario: string | undefined,\r\n  apiKey: string,\r\n  provider: APIProvider\r\n): Promise<string> {\r\n  const prompt = buildScenarioPrompt(character, userScenario);\r\n  return await generateWithFallback(provider, apiKey, prompt, \"scenario\");\r\n}\r\n\r\n/**\r\n * Generate initial message\r\n */\r\nexport async function generateInitialMessage(\r\n  character: CharacterState,\r\n  scenario: string | undefined,\r\n  apiKey: string,\r\n  provider: APIProvider\r\n): Promise<string> {\r\n  const prompt = buildInitialMessagePrompt(character, scenario);\r\n  return await generateWithFallback(provider, apiKey, prompt, \"initialMessage\");\r\n}\r\n\r\n/**\r\n * Generate COMBINED scenario for multiple characters in one story\r\n */\r\nexport async function generateCombinedScenario(\r\n  characters: CharacterState[],\r\n  userScenario: string | undefined,\r\n  apiKey: string,\r\n  provider: APIProvider\r\n): Promise<string> {\r\n  const prompt = buildCombinedScenarioPrompt(characters, userScenario);\r\n  // Use scenario type but with increased tokens for multiple characters\r\n  return await generateWithFallback(provider, apiKey, prompt, \"scenario\");\r\n}\r\n\r\n/**\r\n * Validate API key and auto-detect provider\r\n */\r\nexport function validateAPIKey(): { valid: boolean; apiKey: string | null; provider: APIProvider | null; error?: string } {\r\n  // First try to get selected provider\r\n  const selectedProvider = getSelectedProvider();\r\n  let apiKey: string | null = null;\r\n  let provider: APIProvider | null = selectedProvider;\r\n  \r\n  if (selectedProvider) {\r\n    apiKey = getAPIKey(selectedProvider);\r\n    if (apiKey && apiKey.trim() !== \"\" && apiKey.length >= 10) {\r\n      return { valid: true, apiKey, provider: selectedProvider };\r\n    }\r\n  }\r\n  \r\n  // Auto-detect from all stored keys\r\n  const providers: APIProvider[] = [\"openai\", \"gemini\", \"openrouter\", \"huggingface\"];\r\n  for (const p of providers) {\r\n    const key = getAPIKey(p);\r\n    if (key && key.trim() !== \"\" && key.length >= 10) {\r\n      const detected = detectProviderFromKey(key);\r\n      if (detected === p) {\r\n        // Update selected provider\r\n        localStorage.setItem(\"api_key_provider\", p);\r\n        localStorage.setItem(\"api_key_connected\", \"true\");\r\n        return { valid: true, apiKey: key, provider: p };\r\n      }\r\n    }\r\n  }\r\n  \r\n  return {\r\n    valid: false,\r\n    apiKey: null,\r\n    provider: null,\r\n    error: \"No valid API key found. Please add an API key in the API Key Manager.\",\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1932, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/lib/supabase/client.ts"],"sourcesContent":["\r\nimport { createBrowserClient } from '@supabase/ssr'\r\n\r\nexport const createClient = () =>\r\n    createBrowserClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    )\r\n"],"names":[],"mappings":";;;;AACA;AAAA;;AAEO,MAAM,eAAe,IACxB,IAAA,4OAAmB"}},
    {"offset": {"line": 1944, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/lib/supabase/characters.ts"],"sourcesContent":["import { createClient } from './client';\r\n\r\nexport interface SavedCharacter {\r\n  id: string;\r\n  user_id: string;\r\n  name: string;\r\n  age: string;\r\n  gender: string;\r\n  setting: string;\r\n  relationship: string;\r\n  personality_warmth: number;\r\n  personality_confidence: number;\r\n  personality_calmness: number;\r\n  personality_reserve: number;\r\n  backstory_style?: string;\r\n  speech_tone?: string;\r\n  speech_vocabulary?: string;\r\n  speech_patterns?: string;\r\n  content_rating?: string;\r\n  topics?: string;\r\n  tone?: string;\r\n  generated_personality?: string;\r\n  generated_backstory?: string;\r\n  generated_traits?: string;\r\n  generated_speech?: string;\r\n  generated_initial_message?: string;\r\n  generated_scenario?: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CharacterInput {\r\n  name: string;\r\n  age: string;\r\n  gender: string;\r\n  setting: string;\r\n  relationship: string;\r\n  personality: {\r\n    warmth: number;\r\n    confidence: number;\r\n    calmness: number;\r\n    reserve: number;\r\n  };\r\n  backstoryStyle?: string;\r\n  speechRules?: {\r\n    tone?: string;\r\n    vocabulary?: string;\r\n    patterns?: string;\r\n  };\r\n  boundaries?: {\r\n    contentRating?: string;\r\n    topics?: string;\r\n    tone?: string;\r\n  };\r\n  generatedContent?: {\r\n    personality?: string;\r\n    backstory?: string;\r\n    traits?: string;\r\n    speech?: string;\r\n    initialMessage?: string;\r\n    scenario?: string;\r\n  };\r\n}\r\n\r\n// Save a character to Supabase\r\nexport async function saveCharacter(character: CharacterInput): Promise<{ data: SavedCharacter | null; error: string | null }> {\r\n  const supabase = createClient();\r\n  \r\n  // Get current user\r\n  const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n  \r\n  if (userError || !user) {\r\n    return { data: null, error: 'User not authenticated' };\r\n  }\r\n\r\n  const characterData = {\r\n    user_id: user.id,\r\n    name: character.name,\r\n    age: character.age,\r\n    gender: character.gender,\r\n    setting: character.setting,\r\n    relationship: character.relationship,\r\n    personality_warmth: character.personality.warmth,\r\n    personality_confidence: character.personality.confidence,\r\n    personality_calmness: character.personality.calmness,\r\n    personality_reserve: character.personality.reserve,\r\n    backstory_style: character.backstoryStyle || null,\r\n    speech_tone: character.speechRules?.tone || null,\r\n    speech_vocabulary: character.speechRules?.vocabulary || null,\r\n    speech_patterns: character.speechRules?.patterns || null,\r\n    content_rating: character.boundaries?.contentRating || null,\r\n    topics: character.boundaries?.topics || null,\r\n    tone: character.boundaries?.tone || null,\r\n    generated_personality: character.generatedContent?.personality || null,\r\n    generated_backstory: character.generatedContent?.backstory || null,\r\n    generated_traits: character.generatedContent?.traits || null,\r\n    generated_speech: character.generatedContent?.speech || null,\r\n    generated_initial_message: character.generatedContent?.initialMessage || null,\r\n    generated_scenario: character.generatedContent?.scenario || null,\r\n    updated_at: new Date().toISOString(),\r\n  };\r\n\r\n  const { data, error } = await supabase\r\n    .from('characters')\r\n    .insert(characterData)\r\n    .select()\r\n    .single();\r\n\r\n  if (error) {\r\n    console.error('Error saving character:', error);\r\n    return { data: null, error: error.message };\r\n  }\r\n\r\n  return { data, error: null };\r\n}\r\n\r\n// Get all characters for the current user\r\nexport async function getUserCharacters(): Promise<{ data: SavedCharacter[]; error: string | null }> {\r\n  const supabase = createClient();\r\n  \r\n  const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n  \r\n  if (userError || !user) {\r\n    return { data: [], error: 'User not authenticated' };\r\n  }\r\n\r\n  const { data, error } = await supabase\r\n    .from('characters')\r\n    .select('*')\r\n    .eq('user_id', user.id)\r\n    .order('created_at', { ascending: false });\r\n\r\n  if (error) {\r\n    console.error('Error fetching characters:', error);\r\n    return { data: [], error: error.message };\r\n  }\r\n\r\n  return { data: data || [], error: null };\r\n}\r\n\r\n// Get a single character by ID\r\nexport async function getCharacterById(characterId: string): Promise<{ data: SavedCharacter | null; error: string | null }> {\r\n  const supabase = createClient();\r\n  \r\n  const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n  \r\n  if (userError || !user) {\r\n    return { data: null, error: 'User not authenticated' };\r\n  }\r\n\r\n  const { data, error } = await supabase\r\n    .from('characters')\r\n    .select('*')\r\n    .eq('id', characterId)\r\n    .eq('user_id', user.id)\r\n    .single();\r\n\r\n  if (error) {\r\n    console.error('Error fetching character:', error);\r\n    return { data: null, error: error.message };\r\n  }\r\n\r\n  return { data, error: null };\r\n}\r\n\r\n// Update a character\r\nexport async function updateCharacterById(\r\n  characterId: string,\r\n  updates: Partial<CharacterInput>\r\n): Promise<{ data: SavedCharacter | null; error: string | null }> {\r\n  const supabase = createClient();\r\n  \r\n  const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n  \r\n  if (userError || !user) {\r\n    return { data: null, error: 'User not authenticated' };\r\n  }\r\n\r\n  const updateData: Record<string, unknown> = {\r\n    updated_at: new Date().toISOString(),\r\n  };\r\n\r\n  if (updates.name) updateData.name = updates.name;\r\n  if (updates.age) updateData.age = updates.age;\r\n  if (updates.gender) updateData.gender = updates.gender;\r\n  if (updates.setting) updateData.setting = updates.setting;\r\n  if (updates.relationship) updateData.relationship = updates.relationship;\r\n  if (updates.personality) {\r\n    updateData.personality_warmth = updates.personality.warmth;\r\n    updateData.personality_confidence = updates.personality.confidence;\r\n    updateData.personality_calmness = updates.personality.calmness;\r\n    updateData.personality_reserve = updates.personality.reserve;\r\n  }\r\n  if (updates.backstoryStyle) updateData.backstory_style = updates.backstoryStyle;\r\n  if (updates.speechRules) {\r\n    updateData.speech_tone = updates.speechRules.tone;\r\n    updateData.speech_vocabulary = updates.speechRules.vocabulary;\r\n    updateData.speech_patterns = updates.speechRules.patterns;\r\n  }\r\n  if (updates.boundaries) {\r\n    updateData.content_rating = updates.boundaries.contentRating;\r\n    updateData.topics = updates.boundaries.topics;\r\n    updateData.tone = updates.boundaries.tone;\r\n  }\r\n  if (updates.generatedContent) {\r\n    updateData.generated_personality = updates.generatedContent.personality;\r\n    updateData.generated_backstory = updates.generatedContent.backstory;\r\n    updateData.generated_traits = updates.generatedContent.traits;\r\n    updateData.generated_speech = updates.generatedContent.speech;\r\n    updateData.generated_initial_message = updates.generatedContent.initialMessage;\r\n    updateData.generated_scenario = updates.generatedContent.scenario;\r\n  }\r\n\r\n  const { data, error } = await supabase\r\n    .from('characters')\r\n    .update(updateData)\r\n    .eq('id', characterId)\r\n    .eq('user_id', user.id)\r\n    .select()\r\n    .single();\r\n\r\n  if (error) {\r\n    console.error('Error updating character:', error);\r\n    return { data: null, error: error.message };\r\n  }\r\n\r\n  return { data, error: null };\r\n}\r\n\r\n// Delete a character\r\nexport async function deleteCharacter(characterId: string): Promise<{ error: string | null }> {\r\n  const supabase = createClient();\r\n  \r\n  const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n  \r\n  if (userError || !user) {\r\n    return { error: 'User not authenticated' };\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from('characters')\r\n    .delete()\r\n    .eq('id', characterId)\r\n    .eq('user_id', user.id);\r\n\r\n  if (error) {\r\n    console.error('Error deleting character:', error);\r\n    return { error: error.message };\r\n  }\r\n\r\n  return { error: null };\r\n}\r\n\r\n// Get current user\r\nexport async function getCurrentUser() {\r\n  const supabase = createClient();\r\n  const { data: { user }, error } = await supabase.auth.getUser();\r\n  \r\n  if (error) {\r\n    return { user: null, error: error.message };\r\n  }\r\n  \r\n  return { user, error: null };\r\n}\r\n\r\n// Convert SavedCharacter to CharacterInput format for use in context\r\nexport function savedCharacterToInput(saved: SavedCharacter): CharacterInput {\r\n  return {\r\n    name: saved.name,\r\n    age: saved.age,\r\n    gender: saved.gender,\r\n    setting: saved.setting,\r\n    relationship: saved.relationship,\r\n    personality: {\r\n      warmth: saved.personality_warmth,\r\n      confidence: saved.personality_confidence,\r\n      calmness: saved.personality_calmness,\r\n      reserve: saved.personality_reserve,\r\n    },\r\n    backstoryStyle: saved.backstory_style || undefined,\r\n    speechRules: {\r\n      tone: saved.speech_tone || undefined,\r\n      vocabulary: saved.speech_vocabulary || undefined,\r\n      patterns: saved.speech_patterns || undefined,\r\n    },\r\n    boundaries: {\r\n      contentRating: saved.content_rating || undefined,\r\n      topics: saved.topics || undefined,\r\n      tone: saved.tone || undefined,\r\n    },\r\n    generatedContent: {\r\n      personality: saved.generated_personality || undefined,\r\n      backstory: saved.generated_backstory || undefined,\r\n      traits: saved.generated_traits || undefined,\r\n      speech: saved.generated_speech || undefined,\r\n      initialMessage: saved.generated_initial_message || undefined,\r\n      scenario: saved.generated_scenario || undefined,\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2183, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/OneDrive/Desktop/anisoul-forge/app/characters/results/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { ChevronDown, ArrowLeft, Loader2, Users, Save, Check } from \"lucide-react\";\nimport { useCharacter } from \"@/context/CharacterContext\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { APIKeyManager } from \"@/components/api-key-manager\";\nimport { TerminalOutput } from \"@/components/terminal-output\";\nimport { validateAPIKey, generatePersonality, generateCombinedScenario } from \"@/lib/generation/service\";\nimport { isAPIKeyConnected, APIProvider } from \"@/lib/api-key\";\nimport { saveCharacter, getCurrentUser } from \"@/lib/supabase/characters\";\n\ntype SectionId = \"personality\";\n\ninterface SectionState {\n  loading: boolean;\n  error: string | null;\n  content: string;\n}\n\ninterface CombinedScenarioState {\n  loading: boolean;\n  error: string | null;\n  content: string;\n}\n\nexport default function MultipleCharactersResultPage() {\n  const router = useRouter();\n  const { characters, updateCharacter } = useCharacter();\n  const [expandedCards, setExpandedCards] = useState<Set<string>>(new Set(characters.map(c => c.id)));\n  const [showAPIKeyModal, setShowAPIKeyModal] = useState(false);\n  const [scenarioInput, setScenarioInput] = useState(\"\");\n  const [showScenarioModal, setShowScenarioModal] = useState(false);\n  const [generationStates, setGenerationStates] = useState<Record<string, Record<SectionId, SectionState>>>({});\n  const [generatingCharacters, setGeneratingCharacters] = useState<Set<string>>(new Set());\n  \n  // Combined scenario state (one for all characters)\n  const [combinedScenario, setCombinedScenario] = useState<CombinedScenarioState>({\n    loading: false,\n    error: null,\n    content: \"\",\n  });\n  const [isGeneratingScenario, setIsGeneratingScenario] = useState(false);\n  const [allPersonalitiesGenerated, setAllPersonalitiesGenerated] = useState(false);\n  \n  // Save states\n  const [isSaving, setIsSaving] = useState(false);\n  const [isSaved, setIsSaved] = useState(false);\n  const [saveError, setSaveError] = useState<string | null>(null);\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n\n  // Check if user is logged in\n  useEffect(() => {\n    const checkUser = async () => {\n      const { user } = await getCurrentUser();\n      setIsLoggedIn(!!user);\n    };\n    checkUser();\n  }, []);\n\n  // Initialize generation states from character data\n  useEffect(() => {\n    const states: Record<string, Record<SectionId, SectionState>> = {};\n    characters.forEach((char) => {\n      states[char.id] = {\n        personality: {\n          loading: false,\n          error: null,\n          content: char.generatedContent?.personality || \"\",\n        },\n      };\n    });\n    setGenerationStates(states);\n    \n    // Check if there's already a combined scenario stored\n    const firstCharWithScenario = characters.find(c => c.generatedContent?.scenario);\n    if (firstCharWithScenario?.generatedContent?.scenario) {\n      setCombinedScenario({\n        loading: false,\n        error: null,\n        content: firstCharWithScenario.generatedContent.scenario,\n      });\n    }\n  }, [characters.length]);\n\n  // Check API key and generate for characters that need it\n  useEffect(() => {\n    if (characters.length === 0) return;\n\n    // HARD BLOCK: Check API key\n    if (!isAPIKeyConnected()) {\n      setShowAPIKeyModal(true);\n      return;\n    }\n\n    // Generate personalities for characters that don't have content yet\n    characters.forEach((char) => {\n      if (!char.generatedContent?.personality && !generatingCharacters.has(char.id)) {\n        handleGeneratePersonality(char.id);\n      }\n    });\n  }, [characters.length]);\n\n  // Check if all personalities are generated\n  useEffect(() => {\n    const allGenerated = characters.every(\n      (char) => char.generatedContent?.personality || generationStates[char.id]?.personality?.content\n    );\n    setAllPersonalitiesGenerated(allGenerated);\n    \n    // Show scenario modal when all personalities are done\n    if (allGenerated && !combinedScenario.content && !showScenarioModal && characters.length > 0) {\n      const anyGenerating = Array.from(generatingCharacters).length > 0;\n      if (!anyGenerating) {\n        setShowScenarioModal(true);\n      }\n    }\n  }, [characters, generationStates, generatingCharacters, combinedScenario.content]);\n\n  // Listen for API key changes\n  useEffect(() => {\n    const handleStorageChange = () => {\n      if (isAPIKeyConnected()) {\n        characters.forEach((char) => {\n          if (!char.generatedContent?.personality && !generatingCharacters.has(char.id)) {\n            handleGeneratePersonality(char.id);\n          }\n        });\n      }\n    };\n    \n    window.addEventListener(\"storage\", handleStorageChange);\n    return () => window.removeEventListener(\"storage\", handleStorageChange);\n  }, [characters.length]);\n\n  const updateGenerationState = useCallback((characterId: string, sectionId: SectionId, updates: Partial<SectionState>) => {\n    setGenerationStates((prev) => ({\n      ...prev,\n      [characterId]: {\n        ...prev[characterId],\n        [sectionId]: { ...prev[characterId]?.[sectionId], ...updates },\n      },\n    }));\n  }, []);\n\n  const updateCharacterContent = useCallback((characterId: string, content: string, type: \"personality\" | \"scenario\") => {\n    const charIndex = characters.findIndex((c) => c.id === characterId);\n    if (charIndex !== -1) {\n      const character = characters[charIndex];\n      const currentContent = character.generatedContent || {};\n      updateCharacter(charIndex, {\n        generatedContent: {\n          ...currentContent,\n          [type]: content,\n        },\n      });\n    }\n  }, [characters, updateCharacter]);\n\n  const handleGeneratePersonality = async (characterId: string, apiKey?: string, provider?: APIProvider) => {\n    const character = characters.find((c) => c.id === characterId);\n    if (!character) return;\n\n    const keyCheck = apiKey && provider \n      ? { valid: true, apiKey, provider, error: undefined as string | undefined } \n      : validateAPIKey();\n    if (!keyCheck.valid || !keyCheck.apiKey || !keyCheck.provider) {\n      setShowAPIKeyModal(true);\n      return;\n    }\n\n    setGeneratingCharacters((prev) => new Set(prev).add(characterId));\n    updateGenerationState(characterId, \"personality\", { loading: true, error: null });\n\n    try {\n      const content = await generatePersonality(character, keyCheck.apiKey, keyCheck.provider);\n\n      if (!content || content.trim() === \"\") {\n        throw new Error(\"Generation returned empty content. Please try again.\");\n      }\n\n      updateGenerationState(characterId, \"personality\", { loading: false, error: null, content });\n      updateCharacterContent(characterId, content, \"personality\");\n    } catch (error: any) {\n      updateGenerationState(characterId, \"personality\", {\n        loading: false,\n        error: error.message || \"Generation failed\",\n        content: generationStates[characterId]?.personality?.content || \"\",\n      });\n    } finally {\n      setGeneratingCharacters((prev) => {\n        const next = new Set(prev);\n        next.delete(characterId);\n        return next;\n      });\n    }\n  };\n\n  const handleGenerateCombinedScenario = async (userScenario?: string) => {\n    const keyCheck = validateAPIKey();\n    if (!keyCheck.valid || !keyCheck.apiKey || !keyCheck.provider) {\n      setShowAPIKeyModal(true);\n      return;\n    }\n\n    setIsGeneratingScenario(true);\n    setCombinedScenario((prev) => ({ ...prev, loading: true, error: null }));\n\n    try {\n      // Generate combined scenario for all characters\n      const content = await generateCombinedScenario(characters, userScenario, keyCheck.apiKey, keyCheck.provider);\n\n      if (!content || content.trim() === \"\") {\n        throw new Error(\"Generation returned empty content. Please try again.\");\n      }\n\n      setCombinedScenario({ loading: false, error: null, content });\n      \n      // Store the combined scenario in all characters\n      characters.forEach((char) => {\n        updateCharacterContent(char.id, content, \"scenario\");\n      });\n    } catch (error: any) {\n      setCombinedScenario((prev) => ({\n        ...prev,\n        loading: false,\n        error: error.message || \"Generation failed\",\n      }));\n    } finally {\n      setIsGeneratingScenario(false);\n    }\n  };\n\n  const handleScenarioSubmit = async () => {\n    setShowScenarioModal(false);\n    await handleGenerateCombinedScenario(scenarioInput.trim() || undefined);\n  };\n\n  const handleSkipScenario = async () => {\n    setShowScenarioModal(false);\n    setScenarioInput(\"\");\n    await handleGenerateCombinedScenario();\n  };\n\n  const handleRewritePersonality = async (characterId: string) => {\n    await handleGeneratePersonality(characterId);\n  };\n\n  const handleRewriteScenario = async () => {\n    await handleGenerateCombinedScenario();\n  };\n\n  const handleSaveAllToProfile = async () => {\n    if (isSaving || isSaved) return;\n    \n    const { user } = await getCurrentUser();\n    if (!user) {\n      router.push(\"/auth/signin\");\n      return;\n    }\n\n    setIsSaving(true);\n    setSaveError(null);\n\n    try {\n      for (const character of characters) {\n        const { error } = await saveCharacter({\n          name: character.basics.name,\n          age: character.basics.age,\n          gender: character.basics.gender,\n          setting: character.basics.setting,\n          relationship: character.basics.relationship,\n          personality: character.personality,\n          backstoryStyle: character.backstoryStyle,\n          speechRules: character.speechRules,\n          boundaries: character.boundaries,\n          generatedContent: {\n            ...character.generatedContent,\n            scenario: combinedScenario.content,\n          },\n        });\n\n        if (error) {\n          throw new Error(error);\n        }\n      }\n\n      setIsSaved(true);\n      setTimeout(() => setIsSaved(false), 3000);\n    } catch (err: any) {\n      setSaveError(err.message || \"Failed to save characters\");\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const toggleCard = (characterId: string) => {\n    setExpandedCards((prev) => {\n      const next = new Set(prev);\n      if (next.has(characterId)) {\n        next.delete(characterId);\n      } else {\n        next.add(characterId);\n      }\n      return next;\n    });\n  };\n\n  // Character names for display\n  const characterNames = useMemo(() => \n    characters.map(c => c.basics.name).filter(Boolean).join(\" & \"),\n    [characters]\n  );\n\n  if (characters.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center px-4\">\n        <div className=\"text-center\">\n          <p className=\"text-xl font-semibold text-foreground mb-4\">No characters found</p>\n          <Link\n            href=\"/create\"\n            className=\"inline-block px-6 py-3 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium transition-colors\"\n          >\n            Create Characters\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background px-4 py-8\">\n      <div className=\"max-w-5xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <Link\n            href=\"/wizard\"\n            className=\"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n            <span className=\"text-sm\">Back to Wizard</span>\n          </Link>\n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"w-10 h-10 rounded-xl bg-violet-500/20 flex items-center justify-center\">\n              <Users className=\"w-5 h-5 text-violet-400\" />\n            </div>\n            <h1 className=\"text-4xl font-bold text-foreground\">\n              {characters.length} Characters\n            </h1>\n          </div>\n          <p className=\"text-muted-foreground\">\n            {characterNames || \"Your characters\"} ‚Äî One shared story\n          </p>\n        </div>\n\n        {/* Individual Character Personality Sections */}\n        <div className=\"space-y-4 mb-8\">\n          <h2 className=\"text-lg font-semibold text-foreground flex items-center gap-2\">\n            <span className=\"w-2 h-2 rounded-full bg-violet-500\" />\n            Individual Personalities\n          </h2>\n          \n          {characters.map((character, index) => {\n            const isExpanded = expandedCards.has(character.id);\n            const isGenerating = generatingCharacters.has(character.id);\n            const states = generationStates[character.id] || {\n              personality: { loading: false, error: null, content: \"\" },\n            };\n\n            return (\n              <motion.div\n                key={character.id}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: index * 0.1 }}\n                className=\"glass rounded-2xl border border-border overflow-hidden\"\n              >\n                {/* Card Header */}\n                <button\n                  onClick={() => toggleCard(character.id)}\n                  className=\"w-full p-6 flex items-center justify-between hover:bg-white/5 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-4\">\n                    <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-violet-500/30 to-blue-500/30 flex items-center justify-center\">\n                      <span className=\"text-xl font-bold text-foreground\">{index + 1}</span>\n                    </div>\n                    <div className=\"text-left\">\n                      <h3 className=\"text-xl font-semibold text-foreground\">\n                        {character.basics.name || `Character ${index + 1}`}\n                      </h3>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {character.basics.gender} ‚Ä¢ {character.basics.age} ‚Ä¢ {character.basics.relationship}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-3\">\n                    {states.personality.content && (\n                      <span className=\"px-2 py-1 rounded-lg bg-emerald-500/20 text-emerald-400 text-xs font-medium\">\n                        Generated\n                      </span>\n                    )}\n                    {isGenerating && (\n                      <Loader2 className=\"w-5 h-5 text-violet-400 animate-spin\" />\n                    )}\n                    <ChevronDown\n                      className={`w-5 h-5 text-muted-foreground transition-transform ${isExpanded ? \"rotate-180\" : \"\"}`}\n                    />\n                  </div>\n                </button>\n\n                {/* Card Content - Personality Only */}\n                <AnimatePresence>\n                  {isExpanded && (\n                    <motion.div\n                      initial={{ height: 0, opacity: 0 }}\n                      animate={{ height: \"auto\", opacity: 1 }}\n                      exit={{ height: 0, opacity: 0 }}\n                      transition={{ duration: 0.3 }}\n                      className=\"overflow-hidden\"\n                    >\n                      <div className=\"p-6 pt-0\">\n                        <TerminalOutput\n                          title={`${character.basics.name}'s Personality`}\n                          content={states.personality.content}\n                          loading={states.personality.loading}\n                          error={states.personality.error}\n                          onRewrite={() => handleRewritePersonality(character.id)}\n                          isGenerating={isGenerating}\n                        />\n                      </div>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n              </motion.div>\n            );\n          })}\n        </div>\n\n        {/* Combined Scenario & Greeting Section */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-lg font-semibold text-foreground flex items-center gap-2 mb-4\">\n            <span className=\"w-2 h-2 rounded-full bg-blue-500\" />\n            Shared Scenario & Greeting\n            <span className=\"text-sm font-normal text-muted-foreground ml-2\">\n              (All characters in one story)\n            </span>\n          </h2>\n          \n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.3 }}\n          >\n            <TerminalOutput\n              title={`Combined Scenario ‚Äî ${characterNames}`}\n              content={combinedScenario.content}\n              loading={combinedScenario.loading}\n              error={combinedScenario.error}\n              onRewrite={handleRewriteScenario}\n              isGenerating={isGeneratingScenario}\n            />\n          </motion.div>\n        </div>\n\n        {/* Save Error */}\n        {saveError && (\n          <div className=\"mb-4 p-4 rounded-xl bg-red-500/10 border border-red-500/30 text-red-400 text-sm\">\n            {saveError}\n          </div>\n        )}\n\n        {/* Actions */}\n        <div className=\"flex gap-4\">\n          <Link\n            href=\"/create\"\n            className=\"flex-1 py-4 rounded-2xl glass border border-border hover:bg-white/5 transition-colors text-center font-medium\"\n          >\n            Create More\n          </Link>\n          <Link\n            href=\"/wizard\"\n            className=\"flex-1 py-4 rounded-2xl glass border border-border hover:bg-white/5 transition-colors text-center font-medium\"\n          >\n            Edit Characters\n          </Link>\n          <button\n            onClick={handleSaveAllToProfile}\n            disabled={isSaving || isSaved || !allPersonalitiesGenerated || !combinedScenario.content}\n            className={`flex items-center justify-center gap-2 px-8 py-4 rounded-2xl font-semibold transition-colors ${\n              isSaved\n                ? \"bg-emerald-500 text-white\"\n                : \"bg-violet-500 hover:bg-violet-600 text-white\"\n            } disabled:opacity-50`}\n          >\n            {isSaving ? (\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n            ) : isSaved ? (\n              <Check className=\"w-5 h-5\" />\n            ) : (\n              <Save className=\"w-5 h-5\" />\n            )}\n            {isSaving ? \"Saving...\" : isSaved ? \"Saved!\" : isLoggedIn ? \"Save All\" : \"Sign In to Save\"}\n          </button>\n        </div>\n      </div>\n\n      {/* API Key Manager */}\n      <APIKeyManager\n        isOpen={showAPIKeyModal}\n        onClose={() => setShowAPIKeyModal(false)}\n        onSave={() => {\n          setShowAPIKeyModal(false);\n          // Immediately restart generation for all characters\n          characters.forEach((char) => {\n            if (!char.generatedContent?.personality && !generatingCharacters.has(char.id)) {\n              handleGeneratePersonality(char.id);\n            }\n          });\n        }}\n      />\n\n      {/* Combined Scenario Modal */}\n      {showScenarioModal && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n          <div\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm\"\n            onClick={() => {}}\n          />\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            className=\"glass rounded-3xl p-8 max-w-2xl w-full border border-border relative z-10\"\n          >\n            <div className=\"flex items-center gap-3 mb-4\">\n              <div className=\"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center\">\n                <Users className=\"w-5 h-5 text-blue-400\" />\n              </div>\n              <div>\n                <h2 className=\"text-2xl font-bold text-foreground\">\n                  Shared Scenario\n                </h2>\n                <p className=\"text-sm text-muted-foreground\">\n                  For {characterNames}\n                </p>\n              </div>\n            </div>\n            \n            <p className=\"text-muted-foreground mb-6\">\n              Define a scenario where <strong className=\"text-foreground\">{characters.length} characters</strong> interact together. \n              The AI will generate a combined opening scene featuring all of them.\n            </p>\n            \n            <textarea\n              value={scenarioInput}\n              onChange={(e) => setScenarioInput(e.target.value)}\n              placeholder={`e.g., ${characters[0]?.basics.name || \"Character 1\"} and ${characters[1]?.basics.name || \"Character 2\"} meet at a coffee shop during a thunderstorm...`}\n              className=\"w-full h-32 px-4 py-3 rounded-xl glass border border-border focus:border-violet-500 transition-all outline-none resize-none mb-6\"\n            />\n            \n            <div className=\"flex gap-3\">\n              <button\n                onClick={handleSkipScenario}\n                disabled={isGeneratingScenario}\n                className=\"flex-1 py-3 rounded-xl glass border border-border hover:bg-white/5 transition-colors font-medium disabled:opacity-50\"\n              >\n                Skip (AI Generate)\n              </button>\n              <button\n                onClick={handleScenarioSubmit}\n                disabled={isGeneratingScenario}\n                className=\"flex-1 py-3 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\n              >\n                {isGeneratingScenario && <Loader2 className=\"w-4 h-4 animate-spin\" />}\n                Generate Combined Scenario\n              </button>\n            </div>\n          </motion.div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}