module.exports=[28670,(a,b,c)=>{"use strict";b.exports=a.r(31058).vendored.contexts.AppRouterContext},84438,(a,b,c)=>{"use strict";b.exports=a.r(31058).vendored["react-ssr"].ReactServerDOMTurbopackClient},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},57765,(a,b,c)=>{"use strict";b.exports=a.r(31058).vendored.contexts.HooksClientContext},44011,(a,b,c)=>{"use strict";b.exports=a.r(31058).vendored.contexts.ServerInsertedHtml},92314,a=>{"use strict";var b=a.i(91164),c=a.i(49558),d=a.i(84501),e=a.i(50882),f=a.i(5752),g=a.i(9889),h=a.i(86049),i=a.i(12655),j=a.i(7954),k=a.i(55155),l=a.i(65077),m=a.i(72615),n=a.i(36411),o=a.i(74094),p=a.i(42854);function q(){let a=(0,c.useParams)(),q=(0,c.useRouter)(),{characters:r,updateCharacter:s}=(0,j.useCharacter)(),[t,u]=(0,d.useState)(!1),[v,w]=(0,d.useState)(""),[x,y]=(0,d.useState)(!1),[z,A]=(0,d.useState)(!1),[B,C]=(0,d.useState)(!1),[D,E]=(0,d.useState)(!1),[F,G]=(0,d.useState)(null),[H,I]=(0,d.useState)(!1),J=r.find(b=>b.id===a?.id);(0,d.useEffect)(()=>{(async()=>{let{user:a}=await (0,p.getCurrentUser)();I(!!a)})()},[]);let[K,L]=(0,d.useState)({personality:{loading:!1,error:null,content:J?.generatedContent?.personality||""},scenarioGreeting:{loading:!1,error:null,content:J?.generatedContent?.scenario||""},bio:{loading:!1,error:null,content:J?.generatedContent?.bio||""}});(0,d.useEffect)(()=>{if(J){if(J.generatedContent?.personality&&J.generatedContent?.scenario)return void L({personality:{loading:!1,error:null,content:J.generatedContent.personality||""},scenarioGreeting:{loading:!1,error:null,content:J.generatedContent.scenario||""},bio:{loading:!1,error:null,content:J.generatedContent.bio||""}});if(!(0,o.isAPIKeyConnected)())return void u(!0);P()}},[J?.id]),(0,d.useEffect)(()=>{let a=()=>{(0,o.isAPIKeyConnected)()&&!J?.generatedContent?.personality&&P()};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[J?.id]);let M=(0,d.useCallback)((a,b)=>{L(c=>({...c,[a]:{...c[a],...b}}))},[]),N=(0,d.useCallback)((a,b)=>{let c=r.findIndex(a=>a.id===J?.id);-1!==c&&s(c,{generatedContent:{...J?.generatedContent||{},["personality"===a?"personality":"scenarioGreeting"===a?"scenario":"bio"]:b}})},[J,r,s]),O=async(a,b,c)=>{if(!J)return;let d=b&&c?{valid:!0,apiKey:b,provider:c}:(0,n.validateAPIKey)();if(!d.valid||!d.apiKey||!d.provider)throw u(!0),Error(d.error||"API key required");M(a,{loading:!0,error:null});try{let b="";if("personality"===a)b=await (0,n.generatePersonality)(J,d.apiKey,d.provider);else if("scenarioGreeting"===a){let a=v.trim()||void 0;b=await (0,n.generateScenario)(J,a,d.apiKey,d.provider)}else if("bio"===a){let a=K.scenarioGreeting.content||J?.generatedContent?.scenario||"";if(!a)throw Error("Scenario must be generated before bio");b=await (0,n.generateBio)(J,a,d.apiKey,d.provider)}if(!b||""===b.trim())throw Error("Generation returned empty content. Please try again.");M(a,{loading:!1,error:null,content:b}),N(a,b)}catch(b){throw M(a,{loading:!1,error:b.message||"Generation failed",content:K[a].content}),b}},P=async()=>{if(!J||z)return;let a=(0,n.validateAPIKey)();if(!a.valid||!a.apiKey||!a.provider)return void u(!0);A(!0);try{await O("personality",a.apiKey,a.provider),y(!0)}catch(a){console.error("Generation failed:",a)}finally{A(!1)}},Q=async()=>{y(!1);let a=(0,n.validateAPIKey)();if(!a.valid||!a.apiKey||!a.provider)return void u(!0);A(!0);try{await O("scenarioGreeting",a.apiKey,a.provider),await O("bio",a.apiKey,a.provider)}catch(a){console.error("Scenario/Greeting/Bio generation failed:",a)}finally{A(!1)}},R=async()=>{y(!1),w("");let a=(0,n.validateAPIKey)();if(!a.valid||!a.apiKey||!a.provider)return void u(!0);A(!0);try{await O("scenarioGreeting",a.apiKey,a.provider),await O("bio",a.apiKey,a.provider)}catch(a){console.error("Generation failed:",a)}finally{A(!1)}},S=async a=>{await O(a)},T=async()=>{if(!J||B||D)return;let{user:a}=await (0,p.getCurrentUser)();if(!a)return void q.push("/auth/signin");C(!0),G(null);try{let{error:a}=await (0,p.saveCharacter)({name:J.basics.name,age:J.basics.age,gender:J.basics.gender,setting:J.basics.setting,relationship:J.basics.relationship,personality:J.personality,backstoryStyle:J.backstoryStyle,speechRules:J.speechRules,boundaries:J.boundaries,generatedContent:J.generatedContent});a?G(a):(E(!0),setTimeout(()=>E(!1),3e3))}catch(a){G(a.message||"Failed to save character")}finally{C(!1)}};return J?(0,b.jsxs)("div",{className:"min-h-screen bg-background px-4 py-8",children:[(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)(k.default,{href:"/wizard",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6",children:[(0,b.jsx)(f.ArrowLeft,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm",children:"Back to Wizard"})]}),(0,b.jsx)("h1",{className:"text-4xl font-bold text-foreground mb-2",children:J.basics.name}),(0,b.jsxs)("p",{className:"text-muted-foreground",children:[J.basics.setting," â€¢ ",J.basics.age," years old"]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:0},children:(0,b.jsx)(m.TerminalOutput,{title:"Personality Profile",content:K.personality.content,loading:K.personality.loading,error:K.personality.error,onRewrite:()=>S("personality"),isGenerating:z})}),(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:(0,b.jsx)(m.TerminalOutput,{title:"Scenario & Greeting",content:K.scenarioGreeting.content,loading:K.scenarioGreeting.loading,error:K.scenarioGreeting.error,onRewrite:()=>S("scenarioGreeting"),isGenerating:z})}),(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,b.jsx)(m.TerminalOutput,{title:"Character Bio",content:K.bio.content,loading:K.bio.loading,error:K.bio.error,onRewrite:()=>S("bio"),isGenerating:z})})]}),(0,b.jsxs)("div",{className:"mt-8 space-y-4",children:[F&&(0,b.jsx)("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:F}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(k.default,{href:"/create",className:"flex-1 py-4 rounded-2xl glass border border-border hover:bg-white/5 transition-colors text-center font-medium",children:"Create Another"}),(0,b.jsx)("button",{onClick:()=>q.push("/wizard"),className:"flex-1 py-4 rounded-2xl glass border border-border hover:bg-white/5 transition-colors font-medium",children:"Edit Character"}),(0,b.jsxs)("button",{onClick:T,disabled:B||D||!K.personality.content,className:`flex items-center justify-center gap-2 px-6 py-4 rounded-2xl font-semibold transition-colors ${D?"bg-emerald-500 text-white":"bg-violet-500 hover:bg-violet-600 text-white"} disabled:opacity-50`,children:[B?(0,b.jsx)(g.Loader2,{className:"w-5 h-5 animate-spin"}):D?(0,b.jsx)(i.Check,{className:"w-5 h-5"}):(0,b.jsx)(h.Save,{className:"w-5 h-5"}),B?"Saving...":D?"Saved!":H?"Save":"Sign In to Save"]})]})]})]}),(0,b.jsx)(l.APIKeyManager,{isOpen:t,onClose:()=>u(!1),onSave:()=>{u(!1),J.generatedContent?.personality||P()}}),x&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>{}}),(0,b.jsxs)(e.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"glass rounded-3xl p-8 max-w-2xl w-full border border-border relative z-10",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-4",children:"Define Scenario (Optional)"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-6",children:"You can provide a custom scenario or let AI generate one based on your character."}),(0,b.jsx)("textarea",{value:v,onChange:a=>w(a.target.value),placeholder:"e.g., The character is in a coffee shop, waiting for someone. It's raining outside...",className:"w-full h-32 px-4 py-3 rounded-xl glass border border-border focus:border-violet-500 transition-all outline-none resize-none mb-6"}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:R,disabled:z,className:"flex-1 py-3 rounded-xl glass border border-border hover:bg-white/5 transition-colors font-medium disabled:opacity-50",children:"Skip (AI Generate)"}),(0,b.jsx)("button",{onClick:Q,disabled:z,className:"flex-1 py-3 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium transition-colors disabled:opacity-50",children:"Continue"})]})]})]})]}):(0,b.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xl font-semibold text-foreground mb-4",children:"Character not found"}),(0,b.jsx)(k.default,{href:"/create",className:"inline-block px-6 py-3 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium transition-colors",children:"Create Character"})]})})}a.s(["default",()=>q])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__584deaa1._.js.map