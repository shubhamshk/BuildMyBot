module.exports=[28670,(a,b,c)=>{"use strict";b.exports=a.r(31058).vendored.contexts.AppRouterContext},84438,(a,b,c)=>{"use strict";b.exports=a.r(31058).vendored["react-ssr"].ReactServerDOMTurbopackClient},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},57765,(a,b,c)=>{"use strict";b.exports=a.r(31058).vendored.contexts.HooksClientContext},44011,(a,b,c)=>{"use strict";b.exports=a.r(31058).vendored.contexts.ServerInsertedHtml},49659,a=>{"use strict";let b=(0,a.i(16032).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);a.s(["Users",()=>b],49659)},95329,a=>{"use strict";let b=(0,a.i(16032).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);a.s(["ChevronDown",()=>b],95329)},51752,a=>{"use strict";var b=a.i(91164),c=a.i(84501),d=a.i(50882),e=a.i(29578),f=a.i(95329),g=a.i(5752),h=a.i(9889),i=a.i(49659),j=a.i(86049),k=a.i(12655),l=a.i(7954),m=a.i(55155),n=a.i(49558),o=a.i(65077),p=a.i(72615),q=a.i(36411),r=a.i(74094),s=a.i(42854);function t(){let a=(0,n.useRouter)(),{characters:t,updateCharacter:u}=(0,l.useCharacter)(),[v,w]=(0,c.useState)(new Set(t.map(a=>a.id))),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)({}),[F,G]=(0,c.useState)(new Set),[H,I]=(0,c.useState)({loading:!1,error:null,content:""}),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(null),[T,U]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{let{user:a}=await (0,s.getCurrentUser)();U(!!a)})()},[]),(0,c.useEffect)(()=>{let a={};t.forEach(b=>{a[b.id]={personality:{loading:!1,error:null,content:b.generatedContent?.personality||""}}}),E(a);let b=t.find(a=>a.generatedContent?.scenario);b?.generatedContent?.scenario&&I({loading:!1,error:null,content:b.generatedContent.scenario})},[t.length]),(0,c.useEffect)(()=>{if(0!==t.length){if(!(0,r.isAPIKeyConnected)())return void y(!0);t.forEach(a=>{a.generatedContent?.personality||F.has(a.id)||X(a.id)})}},[t.length]),(0,c.useEffect)(()=>{let a=t.every(a=>a.generatedContent?.personality||D[a.id]?.personality?.content);M(a),a&&!H.content&&!B&&t.length>0&&(Array.from(F).length>0||C(!0))},[t,D,F,H.content]),(0,c.useEffect)(()=>{let a=()=>{(0,r.isAPIKeyConnected)()&&t.forEach(a=>{a.generatedContent?.personality||F.has(a.id)||X(a.id)})};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[t.length]);let V=(0,c.useCallback)((a,b,c)=>{E(d=>({...d,[a]:{...d[a],[b]:{...d[a]?.[b],...c}}}))},[]),W=(0,c.useCallback)((a,b,c)=>{let d=t.findIndex(b=>b.id===a);if(-1!==d){let a=t[d].generatedContent||{};u(d,{generatedContent:{...a,[c]:b}})}},[t,u]),X=async(a,b,c)=>{let d=t.find(b=>b.id===a);if(!d)return;let e=b&&c?{valid:!0,apiKey:b,provider:c,error:void 0}:(0,q.validateAPIKey)();if(!e.valid||!e.apiKey||!e.provider)return void y(!0);G(b=>new Set(b).add(a)),V(a,"personality",{loading:!0,error:null});try{let b=await (0,q.generatePersonality)(d,e.apiKey,e.provider);if(!b||""===b.trim())throw Error("Generation returned empty content. Please try again.");V(a,"personality",{loading:!1,error:null,content:b}),W(a,b,"personality")}catch(b){V(a,"personality",{loading:!1,error:b.message||"Generation failed",content:D[a]?.personality?.content||""})}finally{G(b=>{let c=new Set(b);return c.delete(a),c})}},Y=async a=>{let b=(0,q.validateAPIKey)();if(!b.valid||!b.apiKey||!b.provider)return void y(!0);K(!0),I(a=>({...a,loading:!0,error:null}));try{let c=await (0,q.generateCombinedScenario)(t,a,b.apiKey,b.provider);if(!c||""===c.trim())throw Error("Generation returned empty content. Please try again.");I({loading:!1,error:null,content:c}),t.forEach(a=>{W(a.id,c,"scenario")})}catch(a){I(b=>({...b,loading:!1,error:a.message||"Generation failed"}))}finally{K(!1)}},Z=async()=>{C(!1),await Y(z.trim()||void 0)},$=async()=>{C(!1),A(""),await Y()},_=async a=>{await X(a)},aa=async()=>{await Y()},ab=async()=>{if(N||P)return;let{user:b}=await (0,s.getCurrentUser)();if(!b)return void a.push("/auth/signin");O(!0),S(null);try{for(let a of t){let{error:b}=await (0,s.saveCharacter)({name:a.basics.name,age:a.basics.age,gender:a.basics.gender,setting:a.basics.setting,relationship:a.basics.relationship,personality:a.personality,backstoryStyle:a.backstoryStyle,speechRules:a.speechRules,boundaries:a.boundaries,generatedContent:{...a.generatedContent,scenario:H.content}});if(b)throw Error(b)}Q(!0),setTimeout(()=>Q(!1),3e3)}catch(a){S(a.message||"Failed to save characters")}finally{O(!1)}},ac=(0,c.useMemo)(()=>t.map(a=>a.basics.name).filter(Boolean).join(" & "),[t]);return 0===t.length?(0,b.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xl font-semibold text-foreground mb-4",children:"No characters found"}),(0,b.jsx)(m.default,{href:"/create",className:"inline-block px-6 py-3 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium transition-colors",children:"Create Characters"})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-background px-4 py-8",children:[(0,b.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)(m.default,{href:"/wizard",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6",children:[(0,b.jsx)(g.ArrowLeft,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm",children:"Back to Wizard"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-xl bg-violet-500/20 flex items-center justify-center",children:(0,b.jsx)(i.Users,{className:"w-5 h-5 text-violet-400"})}),(0,b.jsxs)("h1",{className:"text-4xl font-bold text-foreground",children:[t.length," Characters"]})]}),(0,b.jsxs)("p",{className:"text-muted-foreground",children:[ac||"Your characters"," — One shared story"]})]}),(0,b.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsx)("span",{className:"w-2 h-2 rounded-full bg-violet-500"}),"Individual Personalities"]}),t.map((a,c)=>{let g=v.has(a.id),i=F.has(a.id),j=D[a.id]||{personality:{loading:!1,error:null,content:""}};return(0,b.jsxs)(d.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*c},className:"glass rounded-2xl border border-border overflow-hidden",children:[(0,b.jsxs)("button",{onClick:()=>{var b;return b=a.id,void w(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})},className:"w-full p-6 flex items-center justify-between hover:bg-white/5 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-violet-500/30 to-blue-500/30 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xl font-bold text-foreground",children:c+1})}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("h3",{className:"text-xl font-semibold text-foreground",children:a.basics.name||`Character ${c+1}`}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.basics.gender," • ",a.basics.age," • ",a.basics.relationship]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[j.personality.content&&(0,b.jsx)("span",{className:"px-2 py-1 rounded-lg bg-emerald-500/20 text-emerald-400 text-xs font-medium",children:"Generated"}),i&&(0,b.jsx)(h.Loader2,{className:"w-5 h-5 text-violet-400 animate-spin"}),(0,b.jsx)(f.ChevronDown,{className:`w-5 h-5 text-muted-foreground transition-transform ${g?"rotate-180":""}`})]})]}),(0,b.jsx)(e.AnimatePresence,{children:g&&(0,b.jsx)(d.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:(0,b.jsx)("div",{className:"p-6 pt-0",children:(0,b.jsx)(p.TerminalOutput,{title:`${a.basics.name}'s Personality`,content:j.personality.content,loading:j.personality.loading,error:j.personality.error,onRewrite:()=>_(a.id),isGenerating:i})})})})]},a.id)})]}),(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-foreground flex items-center gap-2 mb-4",children:[(0,b.jsx)("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),"Shared Scenario & Greeting",(0,b.jsx)("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:"(All characters in one story)"})]}),(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,b.jsx)(p.TerminalOutput,{title:`Combined Scenario — ${ac}`,content:H.content,loading:H.loading,error:H.error,onRewrite:aa,isGenerating:J})})]}),R&&(0,b.jsx)("div",{className:"mb-4 p-4 rounded-xl bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:R}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(m.default,{href:"/create",className:"flex-1 py-4 rounded-2xl glass border border-border hover:bg-white/5 transition-colors text-center font-medium",children:"Create More"}),(0,b.jsx)(m.default,{href:"/wizard",className:"flex-1 py-4 rounded-2xl glass border border-border hover:bg-white/5 transition-colors text-center font-medium",children:"Edit Characters"}),(0,b.jsxs)("button",{onClick:ab,disabled:N||P||!L||!H.content,className:`flex items-center justify-center gap-2 px-8 py-4 rounded-2xl font-semibold transition-colors ${P?"bg-emerald-500 text-white":"bg-violet-500 hover:bg-violet-600 text-white"} disabled:opacity-50`,children:[N?(0,b.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}):P?(0,b.jsx)(k.Check,{className:"w-5 h-5"}):(0,b.jsx)(j.Save,{className:"w-5 h-5"}),N?"Saving...":P?"Saved!":T?"Save All":"Sign In to Save"]})]})]}),(0,b.jsx)(o.APIKeyManager,{isOpen:x,onClose:()=>y(!1),onSave:()=>{y(!1),t.forEach(a=>{a.generatedContent?.personality||F.has(a.id)||X(a.id)})}}),B&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>{}}),(0,b.jsxs)(d.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"glass rounded-3xl p-8 max-w-2xl w-full border border-border relative z-10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:(0,b.jsx)(i.Users,{className:"w-5 h-5 text-blue-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-foreground",children:"Shared Scenario"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["For ",ac]})]})]}),(0,b.jsxs)("p",{className:"text-muted-foreground mb-6",children:["Define a scenario where ",(0,b.jsxs)("strong",{className:"text-foreground",children:[t.length," characters"]})," interact together. The AI will generate a combined opening scene featuring all of them."]}),(0,b.jsx)("textarea",{value:z,onChange:a=>A(a.target.value),placeholder:`e.g., ${t[0]?.basics.name||"Character 1"} and ${t[1]?.basics.name||"Character 2"} meet at a coffee shop during a thunderstorm...`,className:"w-full h-32 px-4 py-3 rounded-xl glass border border-border focus:border-violet-500 transition-all outline-none resize-none mb-6"}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:$,disabled:J,className:"flex-1 py-3 rounded-xl glass border border-border hover:bg-white/5 transition-colors font-medium disabled:opacity-50",children:"Skip (AI Generate)"}),(0,b.jsxs)("button",{onClick:Z,disabled:J,className:"flex-1 py-3 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[J&&(0,b.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}),"Generate Combined Scenario"]})]})]})]})]})}a.s(["default",()=>t])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__928dab99._.js.map